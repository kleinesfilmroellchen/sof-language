<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SOF Programming Language Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="reference-6f154317.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-30750652.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-2895c71b.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">SOF Programming Language Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="welcome-to-the-sof-programming-language-documentation"><a class="header" href="#welcome-to-the-sof-programming-language-documentation">Welcome to the SOF Programming Language documentation!</a></h1>
<p>This documentation details the Stack with Objects and Functions programming language, an experimental stack-based reverse-polish-notation functional programming language created by kleines Filmröllchen.</p>
<p><a href="https://github.com/kleinesfilmroellchen/sof-language">Source code</a></p>
<p>While the README is comprehensive on basic concepts and a good starting point for interested people (like you), the docs shall provide the most thorough information on SOF, including a full language description/specification and a from-scratch tutorial (no programming knowledge required).</p>
<p>This documentation, like all of SOF, is a Work In Progress (WIP). As much as possible, non-implemented features are marked as such. It is licensed under <a href="https://www.gnu.org/licenses/fdl-1.3">GNU FDL 1.3</a>.</p>
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<p>The documentation is mainly split into three parts:</p>
<ul>
<li>The <a href="#sof-language-tutorial-and-guide">Guide</a> provides a tutorial and a guide-like introduction to SOF. Read this if you want to start using the language or are just interested in a high-level explanation targeted at programmers.</li>
<li>The <a href="#the-sof-standard-library">Library documentation</a> provides API documentation for all modules in the standard library. Read this if you want to use standard library functionality.</li>
<li>The <a href="Reference.html">Reference</a> provides a specification for the SOF language. Read this if you’re interested in more details, or want to write an implementation.</li>
</ul>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Copyright (C) 2019-2025 kleines Filmröllchen.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sof-language-tutorial-and-guide"><a class="header" href="#sof-language-tutorial-and-guide">SOF Language tutorial and guide</a></h1>
<p>This section is a tutorial and a more user-focused guide of SOF’s features. It’s recommended that you have some experience programming in common paradigms.</p>
<h2 id="basics"><a class="header" href="#basics">Basics</a></h2>
<p>SOF is an interpreted language. Use the installation steps described in the <a href="https://github.com/kleinesfilmroellchen/sof-language/blob/master/README.md">Readme</a> to install SOF and launch the REPL interpreter. Note that the results of programs you typed in might not be visible; they are probably placed on the stack. This is different to a lot of REPL interpreters (such as Python or JavaShell), which print the result of the last expression, whether you put in a <code>println</code> or not. I recommend typing along with this tutorial and modifying the examples in your own creative ways to learn more about things are done in SOF. All example code shows the input and output of the interpreter, where <code>&gt;&gt;&gt;</code> is a user input line, <code>...</code> is a input continuation line and <code>!!!</code> is an error information starting line.</p>
<p>Let’s get the <a href="https://en.wikipedia.org/wiki/%22Hello,_World!%22_program">Hello World</a> out of the way:</p>
<pre><code class="language-sof">&gt;&gt;&gt; "Hello, world!" writeln
Hello, world!
</code></pre>
<p>This introduces both string literals (double quotes, escape sequences coming soon!) as well as the most basic I/O command: <code>writeln</code>, which takes a string and prints it to standard output, ending the line. Most languages call this command <code>println</code>, a leftover term from when such a command would actually instruct a printer to print the text on paper. But I’m getting off track here.</p>
<p>You may have noticed something weird here. Don’t believe me? Let’s try some arithmetic:</p>
<pre><code class="language-sof">&gt;&gt;&gt; 3 12 + writeln
15
&gt;&gt;&gt; 26 18 * writeln
468
&gt;&gt;&gt; 378 9 / writeln
42
&gt;&gt;&gt; 1 2 + 3 + writeln
6
</code></pre>
<p>You can see that the first line clearly computes 3 + 12, but why is the operator (<code>+</code>, addition) after the numbers it operates on (<code>3</code> and <code>12</code>)? The reason is that the stack-based nature of SOF causes it to have postscript notation: all the operations come after the operands they operate on. Most famously, the document description language PostScript by Adobe uses this operation method, and - surprise, surprise - it works off a stack as well.</p>
<p>Each operation or function will take a different number of arguments that come before it. As we saw, <code>writeln</code> only takes one argument: the thing to be printed, while <code>+</code> takes two arguments: the two numbers to be added. The same goes for the other arithmetic operations, including <code>-</code> not shown here.</p>
<p>With this new knowledge, take a look at the last line. Where is the second operand to the second <code>+</code> instruction? The <code>3</code> is one of them, but the other seems to be missing. Except, of course, it doesn’t.</p>
<p>Any operation that occurs in SOF ever only has the Stack to work with. This means that not only do literals place their values onto the stack, but operations place their result back onto the stack. When the interpreter sees the first <code>+</code>, it retrieves the top two elements on the stack, which in this case happen to be the numbers <code>1</code> and <code>2</code> put there by the literals, and computes their sum. The result, 3, is placed back onto the stack, which can be imagined as shortening the code to <code>3 3 +</code>. The second <code>+</code> doesn’t even know where its numbers come from - they may be from a user input function, they may be literals, they may be the result of an operation or they may be a duplication of another value (which, in this case, is quite possible). As long as they are both numbers, the <code>+</code> sums them and places that value onto the stack, ready for use in the next computation (which happens to be <code>writeln</code>).</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="the-stack"><a class="header" href="#the-stack">The Stack</a></h1>
<p>You can’t understand SOF without understanding the stack. On the flip side, once you do, SOF should feel much more intuitive.</p>
<h2 id="what-is-a-stack"><a class="header" href="#what-is-a-stack">What is a stack?</a></h2>
<p>This section will shortly explain the notion of a stack as used in computer science. Feel free to skip it if you know about stacks and the LIFO principle.</p>
<p>A stack, in computer science, is just like a stack in the real world. Imagine a stack of books:</p>
<pre><code>----------
|  book  |
----------
 |  book  |
 ----------
|  book  |
----------
|  book  |
----------
</code></pre>
<p>These books are heavy - you cannot lift more than one at a time. And because they are placed on top of each other, you can only access the topmost one. For these reasons, you can only do one of two basic things: put another book onto the stack or remove one book from the stack, making the book below that the new topmost book. (Technically, you could also count looking at the topmost book as a basic operation). These operations are called <strong>push</strong> and <strong>pop</strong> (and peek), respectively.</p>
<p>The same thing goes for stacks in computer science, but now the books are stored in electronic memory and the books are data: in the case of SOF numbers, strings, commands, code etc. You will often see a stack being referred to as a LIFO queue, which stands for “last in - first out”, i.e. the last element that went into the “queue” (on top of the stack) is the first element that will be retrieved back with a pop operation.</p>
<h2 id="advanced-stacking"><a class="header" href="#advanced-stacking">Advanced stacking</a></h2>
<p>Here are some cool things to do with a stack:</p>
<pre><code class="language-sof">&gt;&gt;&gt; "world" dup writeln writeln
world
world
</code></pre>
<p>The <code>dup</code> operator, short for duplicate, creates an identical copy of anything on the stack.</p>
<pre><code class="language-sof">&gt;&gt;&gt; 6 7 8 pop writeln
7
</code></pre>
<p>The <code>pop</code> operator does exactly what it says: it discards a value from the stack. In this case, this makes the 7 the topmost element of the stack, which is then printed.</p>
<pre><code class="language-sof">&gt;&gt;&gt; 4 5 swap writeln
4
</code></pre>
<p>The <code>swap</code> operator swaps the topmost two elements of the stack.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="names-and-errors"><a class="header" href="#names-and-errors">Names and Errors</a></h1>
<p>Let’s get into more advanced topics. Variables, branching and of course the programmer’s favorite: Errors.</p>
<h2 id="naming-things"><a class="header" href="#naming-things">Naming things</a></h2>
<p>Right now, we are only using the stack for storing things. We can duplicate, remove and operate on these values, but if we need lower values that were put on the stack previously, we are going to run into some issues quickly. For this reason, we can use the mighty <code>def</code> operator:</p>
<pre><code class="language-sof">&gt;&gt;&gt; 3 x def
&gt;&gt;&gt; # do some stuff here
&gt;&gt;&gt; x . writeln
3
</code></pre>
<p><code>def</code> is short for “define”. In this case it defines that the name <code>x</code> should represent the number value <code>3</code>. Nothing fancy happens, but in the background, SOF created what is essentially a variable of name “x” and given it the value of the number 3. We can now go off and do something else (also note the use of basic <code># comments</code>) and come back later to retrieve x’s value. This is done by giving the “variable”’s name followed by a <code>.</code> . That little dot, the Call operator, is incredibly powerful (and powers, like, everything in SOF at all), but let’s not get ahead of ourselves. Here, it is just used to retrieve the value associated with a name. Also, from now on, we will use the proper SOF terminology and call this simple <code>x</code> an Identifier. It doesn’t do anything on its own, it is just a piece of data that can be used to identify (hence the name) variables and other named things.</p>
<h2 id="making-decisions"><a class="header" href="#making-decisions">Making decisions</a></h2>
<p>You are probably already waiting for conditional execution and all that turing-complete stuff. Here it is:</p>
<pre><code class="language-sof">&gt;&gt;&gt; { "That number is small" writeln } 4 1000 &lt; { "That number is large" writeln } ifelse         
That number is small
&gt;&gt;&gt; { "That number is small" writeln } 2000 1000 &lt; { "That number is large" writeln } ifelse 
That number is large
</code></pre>
<p>There are a bunch of things here that need discussion. The braces delimit code blocks, which are a way of grouping instructions (in this case, two simple output writes) to be executed later. More on them in a bit. The <code>&lt;</code> is a basic comparison operator, a less than operator that needs two numbers and returns a boolean (true/false) according to the comparison result. Finally, the <code>ifelse</code> is an operation that takes in two executable things, in this case the code blocks, and executes them based on the boolean result that lies in between them: if it is true (if the number is smaller than 1000), it executes the first block, if it is false (greater 1000), it executes the second block. A simple if would omit the alternative block and just execute the first block if the condition was true:</p>
<pre><code class="language-sof">&gt;&gt;&gt; { "Primary school completed!" writeln } 2 1 &gt; if
Primary school completed!
&gt;&gt;&gt; { "Primary school completed!" writeln } 2 4 &gt; if
&gt;&gt;&gt;
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<p>Up until now, we have only written simple programs that do not crash, because they conform to SOF’s syntax and other rules. But let’s say you screwed up while typing a string and forgot the closing quote:</p>
<pre><code class="language-sof">&gt;&gt;&gt; "a string
... 
!!! Syntax Error in line 1 at index 1:
 "a string
  ^
    No closing '"' for string literal.
</code></pre>
<p>The first thing that will happen when you try this is that a line with three dots will appear. This is because SOF found the error, but many errors can be corrected on the next line, so it gives you another chance. This error, however, is not resolvable: Ending the continuation line with another press of the enter key will make SOF scream at you. But in a good way.</p>
<p>First, there is the !!! bit, which signals an error. Then, the name of the Error is given. The <a href="#errors-1">section about errors</a> in the reference has information on all errors, but the most common ones are Syntax, your code is sh*t, and Type, your data is sh*t. After the error type comes the information on where the error occurred (possibly incorrect) as well as the segment of code where the error occurred combined with a pointer to the exact character (mostly correct, no guarantees). This helps you find the place of mishap. Finally, there is some additional information on what went wrong: in this case, no closing quote for the string literal was found, which is exactly the error. Note that as with every language, the false behavior might be somewhere else, but wasn’t detected due to legal SOF behavior. For example, you might be passing a wrong parameter to a function, which will only be detected when some operation tries to act on that parameter and finds it to be of a wrong type.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="its-a-bird-its-a-plane-no-wait---its-a-function"><a class="header" href="#its-a-bird-its-a-plane-no-wait---its-a-function">It’s a bird! It’s a plane! No wait - It’s a function!</a></h1>
<p>Functions are essentially code blocks on steroids. They can’t do anything more or less, they are just safer and more convenient. To create a function, this pattern is generally used:</p>
<pre><code class="language-sof"># create the function
{ 3 + return } 1 function addThree globaldef
# and call it
1 addThree : writeln # 4
</code></pre>
<p>The important bit is the primitive token (keyword) <code>function</code>. It takes in a piece of executable SOF code, a “Callable”, as well as an argument count, which is 1 in this case. The code for the function here is a simple code block, the only way you can specify a Callable literally. Code block data behaves like any other data, it lives on the stack and can be assigned a name. Its superpower is <em>delayed execution</em>, that is, the SOF instructions you place inside it are not executed immediately, they are stored, to be run later. In this case, unlike the <code>if</code> and <code>ifelse</code> commands you saw earlier, we don’t even use the stored code directly, instead, we use it as the logic of a newly created function. But the function itself is also just a Callable, some data, now sitting on the stack. To use it repeatedly from anywhere, we must <code>def</code> it like any other variable and give it a name. We use the <code>globaldef</code> in this case, which will always <code>def</code> globally (duh) (Python programmers: compare this to the <code>global</code> keyword). This pattern is SOF convention and allows you to define functions globally even inside other functions and classes.</p>
<p>We can now call the function, like we called the variables beforehand. But behold! This time around, we don’t simply retrieve the Identifier’s “value” with <code>.</code>. That would be the function itself again, which we want to call! For this reason, the double-call operator <code>:</code> exists. It simply executes two calls, the first time retrieving the function, the second time executing it. It is both more performant and more compact than <code>. .</code>, but identical in function.</p>
<p>Now, what happens when we call the function? If you know any programming language, you know that functions (or methods, procedures, lambdas or whatever they’re called) can recieve one or more arguments. SOF, of course, is no different. If you know hardware/assembly-level programming, this may sound familiar: Arguments to an SOF function are expected to be on the stack. The function definition specifies the number of arguments, and SOF places a “stack protector” under all of a function’s arguments. This means that a function’s body cannot change anything that is on the stack, except for its arguments, of course. Also, anything that is on the stack when the function exits will be deleted, up to this “stack protector”. Think of the stack protector as a specially-marked return address in assembler. The function cannot mess with the caller’s stack and cannot clobber it. You can absolutely be sure how many elements from the stack are consumed, according to the function’s argument count.</p>
<p>The code block looks familiar, but it now uses the new-fangled operation <code>return</code>. This will break out of the function body instantly and return the topmost value on the stack from the function. Alternatively, you can use the <code>return:nothing</code> PT, which will end the function without returning anything. This is the default behavior when the function’s end is reached without a <code>return</code>. The return value is placed onto the stack, obviously. In the example we use it as an argument to <code>writeln</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-write-readable-sof-code"><a class="header" href="#how-to-write-readable-sof-code">How to write readable SOF code</a></h1>
<p>This page will outline the conventions, idioms and common practices used when writing SOF code. Following this guide leads to good, idiomatic SOF code and APIs that other developers can use with ease. Most sections are in no particular order.</p>
<h2 id="whitespace-use"><a class="header" href="#whitespace-use">Whitespace use</a></h2>
<p>As SOF is very whitespace insensitive, good code uses whitespace to logically structure the otherwise pretty one-dimensional series of tokens.</p>
<h4 id="token-separation"><a class="header" href="#token-separation">Token separation</a></h4>
<p>Tokens on one line are separated with one single space. An exception is made when you want to align groups of tokens in multiple sequential lines: then, use of multiple spaces between tokens for alignment is encouraged.</p>
<p><em>Example</em>: Defining a number of variables in sequence: Don’t do this:</p>
<pre><code class="language-sof">3 x def
"string" msg def
2 4 * eight def
</code></pre>
<p>Do this:</p>
<pre><code class="language-sof">3        x     def
"string" msg   def
2 4 *    eight def
</code></pre>
<h4 id="line-breaks-and-token-grouping"><a class="header" href="#line-breaks-and-token-grouping">Line breaks and token grouping</a></h4>
<p>Each line should contain one single action, or a logical unit of actions, which might require multiple tokens. In general, PTs should appear on the same line as their arguments, except when these arguments are already on the stack or require a lot of steps to be prepared.</p>
<p>For PTs that take code blocks, such as <code>if</code>, the last closing brace and the PT itself should be on the same line, except when line length would be a problem.</p>
<p>Code blocks should be split up into lines, where the opening and closing brace are on their own line, mimicking the “braces on next line” code style found in C-like languages. Exceptions are when the code block is very short (1-2 tokens) or contains only a single logical action (such as a function call with many parameters).</p>
<p><em>Example</em>: Don’t do this:</p>
<pre><code class="language-sof"># define function
{ pop 15 + return } 2 function someFunction globaldef
# take user input, process it, store it, store a modified version, print one of two messages
input convert:int : true someFunction : dup x def 3 + y def { "large" } { "small" } y . 33 &lt; ifelse
</code></pre>
<p>Do this:</p>
<pre><code class="language-sof"># define function
{
    # discard first argument
    pop
    # compute something
    15 + return
} 2 function someFunction globaldef

# take user input
input convert:int :
# process it
true someFunction : dup
# store it
x def
# store a modified version
3 + y def
# print one of two messages
{ "large" } { "small" } y . 33 &lt; ifelse
</code></pre>
<h4 id="line-indentation"><a class="header" href="#line-indentation">Line indentation</a></h4>
<p>Indenting one level should only be done inside code blocks; this also includes functions and methods. The braces of the code blocks themselves should be on the original indentation level, mimicking the “braces on next line” code style found in C-like languages. Whole-line comments are indented as code would be.</p>
<p><em>Example</em>: Don’t do this:</p>
<pre><code class="language-sof">3 x def
    {
# a comment
    3 someComputation :
 2 someComputation :
      4 writeln
 } 3 4 &lt; if
</code></pre>
<p>Do this:</p>
<pre><code class="language-sof">3 x def
{
    # a comment
    3 someComputation :
    2 someComputation :
    4 writeln
} 3 4 &lt; if
</code></pre>
<p>An exception to the indentation rule are methods: They, together with the constructor, should be aligned one level further than the surrounding code. The constructor defining calls themselves ( <code>3 constructor &lt;classname&gt; globaldef &lt;classname&gt; :</code> ) should be on the same indentation level as the surrounding code.</p>
<h2 id="naming-conventions"><a class="header" href="#naming-conventions">Naming conventions</a></h2>
<p>General naming in SOF is done with CamelCase. All names except for constructors (classes) should be lowercase, constructors are uppercase. <em>Examples</em>: <code>fooFunc</code>, <code>connectToWebservice</code>, <code>doCoolComputation</code>, <code>myVariable</code>, <code>vector1</code>, <code>MyClass</code>, <code>Circle</code>, <code>FileCommunicator</code>. Names in general should be self-explanatory and human-readable, avoid abbreviations and name collisions. (There is no significant speed benefit on shorter names, as all names are identified through some sort of hash)</p>
<p>Special naming conventions are used for functions that provide similar functionality (there is, of course, no function overloading in SOF): functions of this sort should be of the form <code>fname'args:variant</code>. <code>fname</code> is the general name of the function collection. <code>args</code> is either the number of arguments or the argument’s types, separated by additional <code>'</code>. <code>variant</code> is either the variation on the base functionality or the return type.</p>
<p><em>Examples</em>: The functions <code>random:01</code>, <code>random:int</code> and <code>random:float</code> all provide randomness, but <code>:01</code> returns values between 0 and 1, <code>:int</code> returns integers in a range and <code>:float</code> returns floats in a range. Similarly, the function collection <code>convert:&lt;type&gt;</code> includes a lot of functions that convert to a specific type from other supported types. The <code>writef'&lt;argc&gt;</code> functions all provide formatted standard output writing, but with a different number of formatting arguments specified by the <code>argc</code>.</p>
<h3 id="cross-module-naming"><a class="header" href="#cross-module-naming">Cross-module naming</a></h3>
<p>Names in modules can use an underscore to separate pseudo-namespaces (identical to the module name) from actual names. If the function names are reasonably generic and the number of exports in a module is small, this can be omitted.</p>
<p>For example, all the list functions in standard library <code>list</code> have a <code>list_</code> prefix, such as <code>list_elem</code></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="the-sof-standard-library"><a class="header" href="#the-sof-standard-library">The SOF standard library</a></h1>
<p>This is the official collection of library functions and classes provided by the SOF system.</p>
<!-- ## How to write your own library

A library is simply a collection of related functionality, possibly implemented in a native Java class (explanation/implementation plan coming soon!). The tool `sof packlib` can pack a library by investigating the current or a given directory and combining all the found `.sof` source files into one `.soflib` file that is recognized by SOF's `use` PT. -->
<h2 id="methods-on-built-in-types"><a class="header" href="#methods-on-built-in-types">Methods on built-in types</a></h2>
<p>When performing a field call with certain identifiers, certain methods can be retrieved. This allows invoking those methods on primitive types, for example:</p>
<pre><code class="language-sof"># sine of 3.2
3.2 sin ;
# retrieve first element of list
0 [ 1 2 ] idx ;
</code></pre>
<p>Defined methods are described separately for each type in the sub-sections.</p>
<h2 id="files-in-the-standard-library"><a class="header" href="#files-in-the-standard-library">Files in the standard library</a></h2>
<ul>
<li><code>math</code>: Usual mathematical operations.</li>
<li><code>op</code>: Built-in operations as callables.</li>
<li><code>io</code>: (Not implemented) File input/output.</li>
<li><code>fp</code>: (Not implemented) Helpers and tools for functional programming.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="list"><a class="header" href="#list"><code>list</code></a></h1>
<h2 id="idx-index-into-a-list"><a class="header" href="#idx-index-into-a-list"><code>idx</code>: Index into a list</a></h2>
<p><strong>Arguments</strong> &lt; index: Integer &lt; list: List</p>
<p><strong>Return value</strong> &lt; element: the value at index <code>index</code> in the <code>list</code></p>
<p>This function implements normal indexing into a list. Any element can be retrieved from a list by means of its index. Indices are zero-based as in most programming languages. This means that the first element in a list is referred to by an index of zero. Using a negative index will retrieve elements from the end of the list, i.e. an index of -1 refers to the last element of the list (disregarding its size), -2 to the second to last element and so on. This is very useful for list-size-independent indexing from the end.</p>
<p>An index that would reach past the limits of the list throws an <code>IndexError</code>. The <code>element</code> function will always throw for empty lists. The indexing and throwing behavior is inherited by all list functions that take indices, unless noted otherwise.</p>
<h2 id="length-length-of-a-list"><a class="header" href="#length-length-of-a-list"><code>length</code>: Length of a list</a></h2>
<p><strong>Arguments</strong> &lt; list: List</p>
<p><strong>Return value</strong> &lt; List length: Integer</p>
<p>Returns the number of elements in the list, always nonnegative. Returns zero for the empty list.</p>
<h2 id="head-first-element-of-a-list"><a class="header" href="#head-first-element-of-a-list"><code>head</code>: First element of a list</a></h2>
<p><strong>Arguments</strong> &lt; list: List</p>
<p><strong>Return value</strong> &lt; First element in the list: Any value</p>
<p>This function returns the first value of the list. It throws <code>IndexError</code> if the list is empty.</p>
<h2 id="tail-list-tail"><a class="header" href="#tail-list-tail"><code>tail</code>: List tail</a></h2>
<p><strong>Arguments</strong> &lt; list: List</p>
<p><strong>Return value</strong> &lt; The list’s tail: List</p>
<p>Returns a new list that has the first element of the old list removed. Together with <code>head</code>, it can be used to split a list into its first element and its remainder.</p>
<p>Returns an empty list for the empty list.</p>
<h2 id="reverse-reverse-a-list"><a class="header" href="#reverse-reverse-a-list"><code>reverse</code>: Reverse a list</a></h2>
<p><strong>Arguments</strong> &lt; list: List</p>
<p><strong>Return value</strong> &lt; The reverse of the list: List</p>
<p>Returns a new list which has all the elements of the old list, but at inversed positions. For example, the last element is now the first and the second element is now the second-to-last.</p>
<p>Returns the empty list for the empty list.</p>
<h2 id="split-split-up-a-list"><a class="header" href="#split-split-up-a-list"><code>split</code>: Split up a list</a></h2>
<p><strong>Arguments</strong> &lt; index: Integer &lt; list: List</p>
<p><strong>Return value</strong> &lt; A two-element list with the first and second portion of the list, in that order.</p>
<p>This function splits up a list into two halves. The first half contains all elements up to the index (including the element at the index), and the second half contains all elements after the index. The two halves are returned as a list containing two elements. It is a more efficient combination of the <code>take</code> and <code>after</code> functions.</p>
<h2 id="take-first-n-elements-of-a-list"><a class="header" href="#take-first-n-elements-of-a-list"><code>take</code>: First n elements of a list</a></h2>
<p><strong>Arguments</strong> &lt; n: Integer &lt; list: List</p>
<p><strong>Return value</strong> &lt; List of length n: List</p>
<p>Returns a new list that contains the elements of the given list up to the given index, exclusive. For positive n, this always means that the length of the new list is equal to n. Returns the empty list for n=0, returns the entire list if n is greater or equal the list’s length.</p>
<h2 id="after-elements-after-an-index"><a class="header" href="#after-elements-after-an-index"><code>after</code>: Elements after an index</a></h2>
<p><strong>Arguments</strong> &lt; n: Integer &lt; list: List</p>
<p><strong>Return value</strong> &lt; List with elmts after n: List</p>
<p>Inverse of <code>take</code>; returns the elements that <code>take</code> dropped from the list. For positive n, this is equivalent to dropping the first n elements from the list, for negative n, it is equivalent to taking <code>|n|</code> elements from the end of the list (possibly the entire list if <code>|n| &gt; length(list)</code>). For n=0, the entire list is returned. For n greater than list length, the empty list is returned.</p>
<h2 id="first-first-element-of-the-list"><a class="header" href="#first-first-element-of-the-list"><code>first</code>: First element of the list</a></h2>
<p><strong>Arguments</strong> &lt; list: List</p>
<p><strong>Return value</strong> &lt; element: Any value</p>
<p>Returns the first element in the list, equivalent to <code>0 list idx</code>. This is intended for use with tuple-like lists.</p>
<h2 id="second-second-element-of-a-list"><a class="header" href="#second-second-element-of-a-list"><code>second</code>: Second element of a list</a></h2>
<p><strong>Arguments</strong> &lt; list: List</p>
<p><strong>Return value</strong> &lt; second element: Any value</p>
<p>Returns the second element of the list, similar to <code>first</code>, and equivalent to <code>1 list idx</code>.</p>
<h2 id="push-add-to-list"><a class="header" href="#push-add-to-list"><code>push</code>: Add to list</a></h2>
<p><strong>Arguments</strong> &lt; element: Any value &lt; list: List</p>
<p><strong>Return value</strong> &lt; new list: List</p>
<p>Appends the given element to the end of the list.
[defined-behavior]: ../Reference/Language-Specification.md#r-defined-behavior
[defined-behavior.intro]: ../Reference/Language-Specification.md#r-defined-behavior.intro
[defined-behavior.nativecall]: ../Reference/Language-Specification.md#r-defined-behavior.nativecall
[definition]: ../Reference/Language-Specification.md#r-definition
[definition.interpreter]: ../Reference/Language-Specification.md#r-definition.interpreter
[definition.rfc2119]: ../Reference/Language-Specification.md#r-definition.rfc2119
[definition.tool]: ../Reference/Language-Specification.md#r-definition.tool
[error]: ../Reference/Errors.md#r-error
[error.intro]: ../Reference/Errors.md#r-error.intro
[error.kinds]: ../Reference/Errors.md#r-error.kinds
[error.order]: ../Reference/Errors.md#r-error.order
[error.termination]: ../Reference/Errors.md#r-error.termination
[error.ui]: ../Reference/Errors.md#r-error.ui
[execution]: ../Reference/Language-Specification.md#r-execution
[execution.errors]: ../Reference/Language-Specification.md#r-execution.errors
[execution.exit]: ../Reference/Language-Specification.md#r-execution.exit
[execution.opsem]: ../Reference/Language-Specification.md#r-execution.opsem
[intro]: ../Reference/Language-Specification.md#r-intro
[modules]: ../Reference/Module-System.md#r-modules
[modules.errors]: ../Reference/Module-System.md#r-modules.errors
[modules.errors.circular-import]: ../Reference/Module-System.md#r-modules.errors.circular-import
[modules.export]: ../Reference/Module-System.md#r-modules.export
[modules.files]: ../Reference/Module-System.md#r-modules.files
[modules.import]: ../Reference/Module-System.md#r-modules.import
[modules.import.opsem]: ../Reference/Module-System.md#r-modules.import.opsem
[modules.naming]: ../Reference/Module-System.md#r-modules.naming
[modules.naming.absolute]: ../Reference/Module-System.md#r-modules.naming.absolute
[modules.naming.relative]: ../Reference/Module-System.md#r-modules.naming.relative
[modules.nesting]: ../Reference/Module-System.md#r-modules.nesting
[modules.pts]: ../Reference/Module-System.md#r-modules.pts
[modules.resolution]: ../Reference/Module-System.md#r-modules.resolution
[modules.resolution.absolute]: ../Reference/Module-System.md#r-modules.resolution.absolute
[modules.resolution.absolute.contents]: ../Reference/Module-System.md#r-modules.resolution.absolute.contents
[modules.resolution.absolute.use-relative]: ../Reference/Module-System.md#r-modules.resolution.absolute.use-relative
[modules.resolution.common]: ../Reference/Module-System.md#r-modules.resolution.common
[modules.resolution.relative]: ../Reference/Module-System.md#r-modules.resolution.relative
[modules.resolution.relative.up]: ../Reference/Module-System.md#r-modules.resolution.relative.up
[modules.resolution.relative.up.limits]: ../Reference/Module-System.md#r-modules.resolution.relative.up.limits
[naming]: ../Reference/Naming.md#r-naming
[naming.function]: ../Reference/Naming.md#r-naming.function
[naming.function.global-nametable]: ../Reference/Naming.md#r-naming.function.global-nametable
[naming.function.nametable]: ../Reference/Naming.md#r-naming.function.nametable
[pt.dexport]: ../Reference/PTs/Modules.md#r-pt.dexport
[pt.dexport.arguments]: ../Reference/PTs/Modules.md#r-pt.dexport.arguments
[pt.dexport.opsem]: ../Reference/PTs/Modules.md#r-pt.dexport.opsem
[pt.export]: ../Reference/PTs/Modules.md#r-pt.export
[pt.export.arguments]: ../Reference/PTs/Modules.md#r-pt.export.arguments
[pt.export.opsem]: ../Reference/PTs/Modules.md#r-pt.export.opsem
[pt.use]: ../Reference/PTs/Modules.md#r-pt.use
[pt.use.arguments]: ../Reference/PTs/Modules.md#r-pt.use.arguments
[pt.use.opsem]: ../Reference/PTs/Modules.md#r-pt.use.opsem
[source-file]: ../Reference/Language-Specification.md#r-source-file
[source-file.comments]: ../Reference/Language-Specification.md#r-source-file.comments
[source-file.extension]: ../Reference/Language-Specification.md#r-source-file.extension
[source-file.syntax]: ../Reference/Language-Specification.md#r-source-file.syntax
[source-file.syntax.error]: ../Reference/Language-Specification.md#r-source-file.syntax.error
[state]: ../Reference/Language-Specification.md#r-state
[state.call-stack]: ../Reference/Language-Specification.md#r-state.call-stack
[state.stack]: ../Reference/Language-Specification.md#r-state.stack
[type]: ../Reference/Types.md#r-type
[type.boolean]: ../Reference/Types.md#r-type.boolean
[type.boolean.call]: ../Reference/Types.md#r-type.boolean.call
[type.callable]: ../Reference/Types.md#r-type.callable
[type.codeblock]: ../Reference/Types.md#r-type.codeblock
[type.codeblock.call]: ../Reference/Types.md#r-type.codeblock.call
[type.constructor]: ../Reference/Types.md#r-type.constructor
[type.constructor.call]: ../Reference/Types.md#r-type.constructor.call
[type.decimal]: ../Reference/Types.md#r-type.decimal
[type.decimal.nan]: ../Reference/Types.md#r-type.decimal.nan
[type.error]: ../Reference/Types.md#r-type.error
[type.function]: ../Reference/Types.md#r-type.function
[type.function.call]: ../Reference/Types.md#r-type.function.call
[type.hidden]: ../Reference/Types.md#r-type.hidden
[type.identifier]: ../Reference/Types.md#r-type.identifier
[type.identifier.call]: ../Reference/Types.md#r-type.identifier.call
[type.integer]: ../Reference/Types.md#r-type.integer
[type.number]: ../Reference/Types.md#r-type.number
[type.object]: ../Reference/Types.md#r-type.object
[type.primitive]: ../Reference/Types.md#r-type.primitive
[type.primitive.call]: ../Reference/Types.md#r-type.primitive.call
[type.string]: ../Reference/Types.md#r-type.string
[type.value]: ../Reference/Types.md#r-type.value</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="math"><a class="header" href="#math"><code>math</code></a></h1>
<h2 id="abs-absolute-value"><a class="header" href="#abs-absolute-value"><code>abs</code>: Absolute value</a></h2>
<p><strong>Arguments</strong> &lt; a: Number</p>
<p><strong>Return value</strong> &lt; <code>|a|</code>: Number</p>
<p>Returns the absolute value of the given number.</p>
<h2 id="sin-sine"><a class="header" href="#sin-sine"><code>sin</code>: Sine</a></h2>
<p><strong>Arguments</strong> &lt; a: Float</p>
<p><strong>Return value</strong> &lt; <code>sin(a)</code>: Float</p>
<p>Returns the mathematical sine of the input. The input angle is treated as radians.</p>
<h2 id="cos-cosine"><a class="header" href="#cos-cosine"><code>cos</code>: Cosine</a></h2>
<p><strong>Arguments</strong> &lt; a: Float</p>
<p><strong>Return value</strong> &lt; <code>cos(a)</code>: Float</p>
<p>Returns the mathematical cosine of the input. The input angle is treated as radians.</p>
<h2 id="tan-tangent"><a class="header" href="#tan-tangent"><code>tan</code>: Tangent</a></h2>
<p><strong>Arguments</strong> &lt; a: Float</p>
<p><strong>Return value</strong> &lt; <code>tan(a)</code>: Float</p>
<p>Returns the mathematical tangent of the input. The input angle is treated as radians.</p>
<h2 id="exp-exponent"><a class="header" href="#exp-exponent"><code>exp</code>: Exponent</a></h2>
<p><strong>Arguments</strong> &lt; a: Float</p>
<p><strong>Return value</strong> &lt; <code>e^a</code>: Float</p>
<p>Returns e (Euler’s constant, approximately 2.718281) to the power of a. This is the most accurate power function.</p>
<h2 id="ln-natural-logarithm"><a class="header" href="#ln-natural-logarithm"><code>ln</code>: Natural logarithm</a></h2>
<p><strong>Arguments</strong> &lt; a: Float</p>
<p><strong>Return value</strong> &lt; <code>ln(a)</code>: Float</p>
<p>Returns the natural logarithm of a. This is the most accurate logarithm function.</p>
<h2 id="log-logarithm"><a class="header" href="#log-logarithm"><code>log</code>: Logarithm</a></h2>
<p><strong>Arguments</strong> &lt; n: Float &lt; a: Float</p>
<p><strong>Return value</strong> &lt; <code>log_n(a)</code>: Float</p>
<p>Returns the logarithm with the base of n of a. This is mathematically equivalent to <code>ln(a) / ln(n)</code>.</p>
<h2 id="hypot-hypotenuse"><a class="header" href="#hypot-hypotenuse"><code>hypot</code>: Hypotenuse</a></h2>
<p><strong>Arguments</strong> &lt; a: Float &lt; b: Float</p>
<p><strong>Return value</strong> &lt; <code>hypot(a, b)</code>: Float</p>
<p>Returns the size of the hypotenuse with the adjacent and opposite being a and b. This is the value <code>sqrt(a*a + b*b)</code> as calculated by Pythagoras’ formula, but it avoids overflows and imprecisions caused by large intermediary values.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sof-language-specification"><a class="header" href="#sof-language-specification">SOF Language Specification</a></h1>
<div class="rule" id="r-intro"><a class="rule-link" href="#r-intro" title="intro"><span>[intro]</span></a>
</div>

<p>This section specifies the Stack with Objects and Functions programming language.</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>

<p>The reference is in the process of being rewritten in a combined axiomatic + operational semantics (opsem) style to accurately specify all intended behavior of SOF. This rewrite is not yet complete; this is roughly the current state:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""> Introduction, lexing and parsing, baseline definitions, high-level opsem – done</li>
<li><input disabled="" type="checkbox" checked=""> Errors – done</li>
<li><input disabled="" type="checkbox" checked=""> Types – largely complete, may need some more cross-references and elaboration</li>
<li><input disabled="" type="checkbox"> Naming – missing; some behavior specified elsewhere</li>
<li><input disabled="" type="checkbox"> Primitive tokens – largely still in old style which is missing opsem descriptions
<ul>
<li><input disabled="" type="checkbox"> Arithmetic</li>
<li><input disabled="" type="checkbox"> Control Flow</li>
<li><input disabled="" type="checkbox"> Stack &amp; Naming</li>
<li><input disabled="" type="checkbox"> Functional</li>
<li><input disabled="" type="checkbox"> Typing</li>
<li><input disabled="" type="checkbox" checked=""> Modules – complete</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Builtin functions – still in old style which is missing opsem descriptions</li>
<li><input disabled="" type="checkbox" checked=""> Module system – complete</li>
<li><input disabled="" type="checkbox"> Language internals – will be merged into other sections, especially naming</li>
<li><input disabled="" type="checkbox" checked=""> Glossary – needs minor fixes</li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-definition"><a class="rule-link" href="#r-definition" title="definition"><span>[definition]</span></a>
</div>

<h2 id="definitions"><a class="header" href="#definitions">Definitions</a></h2>
<div class="rule" id="r-definition.rfc2119"><a class="rule-link" href="#r-definition.rfc2119" title="definition.rfc2119"><span>[definition<wbr>.rfc2119]</span></a>
</div>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
“SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this
document are to be interpreted as described in <a href="https://www.rfc-editor.org/rfc/rfc2119.html">RFC2119</a>.</p>
<p>Most terms are defined as they are introduced.</p>
<div class="rule" id="r-definition.interpreter"><a class="rule-link" href="#r-definition.interpreter" title="definition.interpreter"><span>[definition<wbr>.interpreter]</span></a>
</div>

<p>An SOF <strong>interpreter</strong> is any program that takes SOF source files as input and executes them according to this language specification, producing identical semantics to any other interpreter. Alternatively, an interpreter MAY also produce another program in source code or machine executable form which produces identical semantics to the SOF source file inputs; what is more commonly called a compiler. This document describes a set of behaviors that are allowed and MUST be followed in an ideal interpreter. In practice, some programs that deviate slightly (most commonly due to bugs) from this specification are also called interpreters.</p>
<div class="rule" id="r-definition.tool"><a class="rule-link" href="#r-definition.tool" title="definition.tool"><span>[definition<wbr>.tool]</span></a>
</div>

<p>An SOF <strong>tool</strong> is any other program that deals with SOF source files. Their behaviors are not prescribed in this specification, and they MAY intentionally go beyond or against the specification to serve a certain purpose. For instance, tools may decide to introspect source code comments for a variety of purposes, while comments must be ignored by interpreters.</p>
<div class="rule" id="r-source-file"><a class="rule-link" href="#r-source-file" title="source-file"><span>[source-file]</span></a>
</div>

<h2 id="source-files"><a class="header" href="#source-files">Source Files</a></h2>
<p>An SOF source file is a program or part of a program in the SOF programming language. Source files are plain text files using UTF-8 <sup class="footnote-reference" id="fr-unicode-1"><a href="#footnote-unicode">1</a></sup> character encoding. Newline sequences consist of an optional carriage return followed by a line feed.</p>
<div class="rule" id="r-source-file.extension"><a class="rule-link" href="#r-source-file.extension" title="source-file.extension"><span>[source-file<wbr>.extension]</span></a>
</div>

<p>Source files use the standard extension <code>.sof</code>.</p>
<div class="rule" id="r-source-file.syntax"><a class="rule-link" href="#r-source-file.syntax" title="source-file.syntax"><span>[source-file<wbr>.syntax]</span></a>
</div>

<p>Source files adhere to the following Extended Backus-Naur form specification:</p>
<pre><code class="language-ebnf">(* A program is a series of tokens and comments, where tokens MUST be separated by whitespace. *)
SofProgram = [Token] { [Comments] ?Whitespace? [Comments] Token } { [Comments] ?Whitespace? } ;

Token = "def" | "globaldef" | "dexport" | "use" | "export"
      | "dup" | "pop" | "swap" | "rot" | "over"
      | "write" | "writeln" | "input" | "inputln"
      | "if" | "ifelse" | "while" | "dowhile" | "switch"
      | "function" | "constructor"
      | "+" | "-" | "*" | "/" | "%" | "&lt;&lt;" | "&gt;&gt;" | "cat"
      | "and" | "or" | "xor" | "not"
      | "&lt;" | "&lt;=" | "&gt;" | "&gt;=" | "=" | "/="
      | "." | ":" | "," | ";" | "nativecall"
      | "[" | "]" | "|"
      | "describe" | "describes" | "assert"
      | Number | String | Boolean
      | Identifier | CodeBlock ;

Identifier = ?Unicode Letter? { ?Unicode Letter? | DecimalDigits | "_" | "'" | ":" } ;
(* A code block recursively contains SOF code, i.e. an SofProgram. *)
CodeBlock = "{" SofProgram "}" ;

(* Literals *)
String = '"' { ?any character except "? '\"' } '"' ;
Boolean = "true" | "false" | "True" | "False" ;
Number = [ "+" | "-" ] ( Integer | Decimal ) ;
Integer = "0" ( "h" | "x" ) HexDigits { HexDigits }
        | [ "0d" ] DecimalDigits { DecimalDigits }
	| "0o" OctalDigits { DecimalDigits }
	| "0b" BinaryDigits { BinaryDigits } ;
Decimal = DecimalDigits { DecimalDigits } "." DecimalDigits { DecimalDigits }
          [ ("e" | "E") ( "+" | "-" ) DecimalDigits { DecimalDigits } ] ;
BinaryDigits = "0" | "1" ;
OctalDigits = BinaryDigits | "2" | "3" | "4" | "5" | "6" | "7" ;
DecimalDigits = OctalDigits | "8" | "9" ;
HexDigits = DecimalDigits | "a" | "b" | "c" | "d" | "e" | "f" | "A" | "B" | "C" | "D" | "E" | "F" ;

(* Comments are ignored. *)
Comments = Comment { Comment } ;
Comment = ( "#" { ?any? } ?Unicode line break/newline? )
        | ( "#*" { ?any? } "*#" ) ;
</code></pre>
<div class="rule" id="r-source-file.syntax.error"><a class="rule-link" href="#r-source-file.syntax.error" title="source-file.syntax.error"><span>[source-file<wbr>.syntax<wbr>.error]</span></a>
</div>

<p>Any violation of this syntax by a program MUST raise a <a href="#errors-1">SyntaxError</a> when given as input to an interpreter.</p>
<p><code>SofProgram</code> is the syntax specification for an entire SOF source file. The source file consists of two types of syntactical constructs: <em>Comments</em> and <em>Tokens</em>.</p>
<div class="rule" id="r-source-file.comments"><a class="rule-link" href="#r-source-file.comments" title="source-file.comments"><span>[source-file<wbr>.comments]</span></a>
</div>

<p>Comments are purely for the benefit of the programmer and MUST NOT have meaning to an SOF interpreter.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>Tokens are the core of the SOF program. The tokens are ordered in a linear sequence. The only exception is the code block token: A code block recursively nests another sequence of tokens. The major other differentiation in the token type is between the <strong>Literal Tokens</strong> that behave and look like the literals in other programming languages, as well as the <strong>Primitive Tokens</strong> aka. keywords that execute program logic. The phrase <strong>Primitive Token</strong> is used to distinguish atomic keywords from the non-atomic <code>{</code> and <code>}</code> keywords.</p>
</blockquote>
</div>

<div class="rule" id="r-state"><a class="rule-link" href="#r-state" title="state"><span>[state]</span></a>
</div>

<h2 id="program-state"><a class="header" href="#program-state">Program state</a></h2>
<p>For semantic purposes, the program state of a running SOF program consists mainly of two things:</p>
<div class="rule" id="r-state.stack"><a class="rule-link" href="#r-state.stack" title="state.stack"><span>[state<wbr>.stack]</span></a>
</div>

<ul>
<li>A stack of values visible to the program. The stack is a LIFO stack/queue (last in, first out) that can contain any kind of value. Of these values, there are types that the user can place and read via the use of certain tokens, and there are the “hidden types” that are used to make the program execute correctly. Hidden types are specified less precisely, and the user is not generally allowed to interact with them.</li>
</ul>
<div class="rule" id="r-state.call-stack"><a class="rule-link" href="#r-state.call-stack" title="state.call-stack"><span>[state<wbr>.call-stack]</span></a>
</div>

<ul>
<li>A stack of token lists that are being executed, with associated information about where these lists come from and what should happen after they finish executing.</li>
</ul>
<div class="rule" id="r-execution"><a class="rule-link" href="#r-execution" title="execution"><span>[execution]</span></a>
</div>

<h2 id="executing"><a class="header" href="#executing">Executing</a></h2>
<div class="rule" id="r-execution.opsem"><a class="rule-link" href="#r-execution.opsem" title="execution.opsem"><span>[execution<wbr>.opsem]</span></a>
</div>

<p>An SOF program consists of a list of tokens. Executing the program consists of running the action of each token in the order it appears in the list of tokens.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>This reference specifies the behavior of each token in the form of <a href="https://en.wikipedia.org/wiki/Operational_semantics"><em>operational semantics</em></a> (opsem), that is: the steps which need to be taken to execute a token correctly.</p>
</blockquote>
</div>

<p>Each token may have an effect on the SOF program environment, modifying it to a new state. Tokens may change the execution state of the program, by modifying the token list stack. For instance:</p>
<ul>
<li>add a token list to be executed next</li>
<li>stop executing the current token list or any others that are being executed</li>
<li>modify the current token list</li>
</ul>
<div class="rule" id="r-execution.errors"><a class="rule-link" href="#r-execution.errors" title="execution.errors"><span>[execution<wbr>.errors]</span></a>
</div>

<p>Tokens may also produce errors, which can then cause further changes to the SOF program environment.</p>
<div class="rule" id="r-execution.exit"><a class="rule-link" href="#r-execution.exit" title="execution.exit"><span>[execution<wbr>.exit]</span></a>
</div>

<p>The SOF program exits when:</p>
<ul>
<li>the last token is executed, and the token list stack is empty.</li>
<li>an uncaught error occurs.</li>
<li>the program is aborted by any other, lower-level means, such as a system call requesting process termination (<code>exit()</code>)</li>
</ul>
<div class="rule" id="r-defined-behavior"><a class="rule-link" href="#r-defined-behavior" title="defined-behavior"><span>[defined-behavior]</span></a>
</div>

<h2 id="defined-behavior"><a class="header" href="#defined-behavior">Defined Behavior</a></h2>
<div class="rule" id="r-defined-behavior.intro"><a class="rule-link" href="#r-defined-behavior.intro" title="defined-behavior.intro"><span>[defined-behavior<wbr>.intro]</span></a>
</div>

<p>By default, any behavior in SOF is considered <strong>defined</strong>. This means that the interpreter MUST NOT deviate from the behavior prescribed in the specification. Some parts of SOF execution are <strong>unspecified</strong> and leave multiple implementation avenues for interpreters. In these cases, any behavior the interpreter chooses to exhibit MUST be limited to this unspecified part. In particular, any behavior exhibited in unspecified sections MUST NOT propagate to the remainder of the program execution. This means that any further execution MUST (return to and) follow defined SOF execution behavior.</p>
<div class="rule" id="r-defined-behavior.nativecall"><a class="rule-link" href="#r-defined-behavior.nativecall" title="defined-behavior.nativecall"><span>[defined-behavior<wbr>.nativecall]</span></a>
</div>

<p>The exception to defined behavior is formed by native functions, invoked through the <code>nativecall</code> operator. As specified, native functions may be supplied by the user and are therefore not part of the interpreter and its guarantees of SOF semantics. The specification for <code>nativecall</code> defines what set of behaviors are allowed for native functions. By virtue of being defined in another programming language, possibly with vastly more flexible behavior than SOF and complex semantics, possibly with far-reaching access to the SOF execution state, the interpreter cannot be expected to verify the correct behavior of all native functions, including catching any incorrect behavior as soon as it happens.</p>
<p>Therefore, if a native function does not uphold the allowed set of behaviors for native functions as laid out in the specification for <code>nativecall</code>, as soon as this function is invoked through use of <code>nativecall</code>, from this point onwards, the interpreter MAY exhibit any possible behavior, including any behavior normally forbidden by this specification. The interpreter MAY never return to defined behavior, as opposed to situations where behavior is locally unspecified. This is called <strong>Undefined Behavior</strong>. Undefined Behavior MUST NOT result from any other action other than the one described.</p>
<!-- #### The literal tokens

The literal tokens are all used to specify a value of a built-in type literally. They most commonly come in the form of basic data types like numbers and literal strings, but technically, code blocks are also literals. When a literal token is encountered, its value is placed on the stack, and the value of the token is derived from its physical form. This is self-explanatory for the literals of type Integer, Float, String (escape processing is explained elsewhere), and Boolean.

For code blocks, the code block's contained tokens must be stored in the data type in some form such that the contained tokens, and even additional code blocks, may be fully reconstructed by the implementation when the code block is later needed. This internal representation is deliberately kept unspecified so that implementations can choose any representation (or even multiple) that is most efficient in their circumstance. The code block, despite its appearance, therefore also just puts a data object on the stack that can later be executed or transformed as specified by the code block semantics. Most of these are given with the PTs that manipulate code blocks and can be found in the language reference. Because code blocks are considered to be immutable, implementations can take appropriate data-sharing measures to reduce these large on-stack data structures in size. -->
<hr>
<ol class="footnote-definition">
<li id="footnote-unicode">
<p>RFC3629: <em>UTF-8, a transformation format of ISO 10646.</em> <a href="https://www.rfc-editor.org/rfc/rfc3629.html">https://www.rfc-editor.org/rfc/rfc3629.html</a> <a href="#fr-unicode-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-error"><a class="rule-link" href="#r-error" title="error"><span>[error]</span></a>
</div>

<h1 id="errors-1"><a class="header" href="#errors-1">Errors</a></h1>
<div class="rule" id="r-error.intro"><a class="rule-link" href="#r-error.intro" title="error.intro"><span>[error<wbr>.intro]</span></a>
</div>

<p>When a problem is encountered with the user-supplied SOF programs or their state during execution, the interpreter MUST throw an error.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>Currently, errors cannot be caught. A feature for catching errors may be added later via the <code>except</code> token.</p>
</blockquote>
</div>

<p>Some errors may not happen in certain interpreters, as there are no strict conditions causing them. These errors MAY be not implemented in the interpreter.</p>
<div class="rule" id="r-error.termination"><a class="rule-link" href="#r-error.termination" title="error.termination"><span>[error<wbr>.termination]</span></a>
</div>

<p>The action of throwing an error terminates the program.</p>
<div class="rule" id="r-error.order"><a class="rule-link" href="#r-error.order" title="error.order"><span>[error<wbr>.order]</span></a>
</div>

<p>When, during execution, any operation fulfils multiple error conditions, and therefore many different errors may be thrown, the exact error thrown (first) is unspecified.</p>
<div class="rule" id="r-error.ui"><a class="rule-link" href="#r-error.ui" title="error.ui"><span>[error<wbr>.ui]</span></a>
</div>

<p>Interpreters MUST inform the user of the fact that an error has occurred. They SHOULD provide further information, such as (but not limited to):</p>
<ul>
<li>Where the error occurred in the program. This includes (if applicable) the current token that was executed when the error occurred, the call stack of functions and other callables that were in progress at the time, and the state of the main stack itself.</li>
<li>The exact condition which caused the error. For example, for an ArithmeticError, the interpreter SHOULD report what operation was invoked with which exact operands.</li>
<li>Resources to learn about the error and how to prevent it, such as documentation links.</li>
</ul>
<div class="rule" id="r-error.kinds"><a class="rule-link" href="#r-error.kinds" title="error.kinds"><span>[error<wbr>.kinds]</span></a>
</div>

<p>Several kinds of errors exist. The following listing contains all the errors defined by and used in the reference. Implementations MAY add additional errors as subtypes of the predefined ones. The conditions under which errors are throw are defined throughout the reference in the context of specific operations and descriptions of SOF execution.</p>
<ul>
<li>SyntaxError</li>
<li>TypeError</li>
<li>NameError</li>
<li>ArithmeticError</li>
<li>StackAccessError</li>
<li>StackSizeError</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type"><a class="rule-link" href="#r-type" title="type"><span>[type]</span></a>
</div>

<h1 id="types"><a class="header" href="#types">Types</a></h1>
<p>Any value that is contained on the stack and visible to the SOF program has one of a few types. Types form a hierarchy, with certain types being considered subtypes of others. This means that any operation allowed on the parent type is also allowed on the subtype, with possibly diverging behavior.</p>
<div class="rule" id="r-type.error"><a class="rule-link" href="#r-type.error" title="type.error"><span>[type<wbr>.error]</span></a>
</div>

<p>Any operation may specify the operand types on which it is valid. Supplying any operation with an operand of a different type causes a <a href="#errors-1">TypeError</a>.</p>
<div class="rule" id="r-type.hidden"><a class="rule-link" href="#r-type.hidden" title="type.hidden"><span>[type<wbr>.hidden]</span></a>
</div>

<p>Some types are considered <strong>hidden</strong>. This means the user cannot fully interact with them.</p>
<div class="rule" id="r-type.value"><a class="rule-link" href="#r-type.value" title="type.value"><span>[type<wbr>.value]</span></a>
</div>

<h2 id="value"><a class="header" href="#value">Value</a></h2>
<p><strong>Value</strong> or <strong>Any</strong> is used to refer to any type, or the union of all types.</p>
<div class="rule" id="r-type.callable"><a class="rule-link" href="#r-type.callable" title="type.callable"><span>[type<wbr>.callable]</span></a>
</div>

<h2 id="callable"><a class="header" href="#callable">Callable</a></h2>
<p><strong>Subtype of:</strong> Value</p>
<p>Any type that can be operated on with the call operator <code>.</code>.</p>
<div class="rule" id="r-type.identifier"><a class="rule-link" href="#r-type.identifier" title="type.identifier"><span>[type<wbr>.identifier]</span></a>
</div>

<h3 id="identifier"><a class="header" href="#identifier">Identifier</a></h3>
<p><strong>Subtype of:</strong> Callable</p>
<p>A string-like type for textual identifiers used in <a href="#r-naming.binding">name binding</a>.</p>
<div class="rule" id="r-type.identifier.call"><a class="rule-link" href="#r-type.identifier.call" title="type.identifier.call"><span>[type<wbr>.identifier<wbr>.call]</span></a>
</div>

<p>Invoking a call on an identifier performs <a href="#r-naming.lookup">name lookup</a>.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>Identifiers provide almost none of the functionality of strings. They are not intended to be used as an alternative string type.</p>
</blockquote>
</div>

<div class="rule" id="r-type.primitive"><a class="rule-link" href="#r-type.primitive" title="type.primitive"><span>[type<wbr>.primitive]</span></a>
</div>

<h3 id="primitive"><a class="header" href="#primitive">Primitive</a></h3>
<p><strong>Subtype of:</strong> Callable</p>
<p>Any type that can be specified with a simple literal.</p>
<div class="rule" id="r-type.primitive.call"><a class="rule-link" href="#r-type.primitive.call" title="type.primitive.call"><span>[type<wbr>.primitive<wbr>.call]</span></a>
</div>

<p>Invoking a call on a primitive performs the identity operation, i.e. it returns the primitive’s value. <code>Boolean</code> is an exception to this.</p>
<div class="rule" id="r-type.number"><a class="rule-link" href="#r-type.number" title="type.number"><span>[type<wbr>.number]</span></a>
</div>

<h3 id="number"><a class="header" href="#number">Number</a></h3>
<p><strong>Subtype of:</strong> Primitive</p>
<p>Any numeric type. Arithmetic operations only operate on numbers.</p>
<div class="rule" id="r-type.integer"><a class="rule-link" href="#r-type.integer" title="type.integer"><span>[type<wbr>.integer]</span></a>
</div>

<h4 id="integer"><a class="header" href="#integer">Integer</a></h4>
<p><strong>Subtype of:</strong> Number</p>
<p>Integral signed number type. MUST be represented in two’s-complement. All operations perform wrapping arithmetic by default, discarding any carries. Minimum representable range must be $[ -2^{63} ; 2^{63}-1 ]$, i.e. 64 bits.</p>
<div class="rule" id="r-type.decimal"><a class="rule-link" href="#r-type.decimal" title="type.decimal"><span>[type<wbr>.decimal]</span></a>
</div>

<h4 id="decimal"><a class="header" href="#decimal">Decimal</a></h4>
<p><strong>Subtype of:</strong> Number</p>
<p>Real number type. The precision required should either match DEC64<sup class="footnote-reference" id="fr-dec64-1"><a href="#footnote-dec64">1</a></sup>, or IEEE 754-2019<sup class="footnote-reference" id="fr-float-1"><a href="#footnote-float">2</a></sup> double-precision floating-point. Higher precision is allowed.</p>
<div class="rule" id="r-type.decimal.nan"><a class="rule-link" href="#r-type.decimal.nan" title="type.decimal.nan"><span>[type<wbr>.decimal<wbr>.nan]</span></a>
</div>

<p>A <em>NaN</em> value of unspecified representation MUST be available. Infinite values may be available and may have specific behavior in certain operations in interpreters that support them. Otherwise, infinities have the behavior of NaN.</p>
<div class="rule" id="r-type.boolean"><a class="rule-link" href="#r-type.boolean" title="type.boolean"><span>[type<wbr>.boolean]</span></a>
</div>

<h3 id="boolean"><a class="header" href="#boolean">Boolean</a></h3>
<p><strong>Subtype of:</strong> Primitive</p>
<p>Truth value, either <code>true</code> or <code>false</code>.</p>
<div class="rule" id="r-type.boolean.call"><a class="rule-link" href="#r-type.boolean.call" title="type.boolean.call"><span>[type<wbr>.boolean<wbr>.call]</span></a>
</div>

<p>When called, it takes two elements from the stack and returns the lower one if it is <code>true</code>, or the higher one if it is <code>false</code>.</p>
<div class="rule" id="r-type.string"><a class="rule-link" href="#r-type.string" title="type.string"><span>[type<wbr>.string]</span></a>
</div>

<h3 id="string"><a class="header" href="#string">String</a></h3>
<p><strong>Subtype of:</strong> Primitive</p>
<p>A string is a sequence of Unicode code points, represented in UTF-8. Its maximum length may be arbitrarily large.</p>
<div class="rule" id="r-type.codeblock"><a class="rule-link" href="#r-type.codeblock" title="type.codeblock"><span>[type<wbr>.codeblock]</span></a>
</div>

<h2 id="codeblock"><a class="header" href="#codeblock">CodeBlock</a></h2>
<p><strong>Subtype of:</strong> Callable</p>
<p>A code block is a list of tokens, created by enclosing these tokens in a pair of braces <code>{</code> and <code>}</code>.</p>
<div class="rule" id="r-type.codeblock.call"><a class="rule-link" href="#r-type.codeblock.call" title="type.codeblock.call"><span>[type<wbr>.codeblock<wbr>.call]</span></a>
</div>

<p>When called, it executes the list of tokens.</p>
<div class="rule" id="r-type.function"><a class="rule-link" href="#r-type.function" title="type.function"><span>[type<wbr>.function]</span></a>
</div>

<h2 id="function"><a class="header" href="#function">Function</a></h2>
<p><strong>Subtype of:</strong> Callable</p>
<p>A function is a combination of a list of tokens to be executed and a positive (or zero) integer amount of arguments.</p>
<div class="rule" id="r-type.function.call"><a class="rule-link" href="#r-type.function.call" title="type.function.call"><span>[type<wbr>.function<wbr>.call]</span></a>
</div>

<p>When a function is called, it retrieves a number of values from the stack equal to the number of arguments. Then, it places a Function Nametable on the stack. Then, it places the arguments back on the stack, in the same order.</p>
<div class="rule" id="r-type.object"><a class="rule-link" href="#r-type.object" title="type.object"><span>[type<wbr>.object]</span></a>
</div>

<h2 id="object"><a class="header" href="#object">Object</a></h2>
<p><strong>Subtype of:</strong> Value</p>
<p>An object is a key-value store that the user can freely modify. When a method is called on the object, the object is used as a nametable, allowing easy modification via normal definition operations.</p>
<div class="rule" id="r-type.constructor"><a class="rule-link" href="#r-type.constructor" title="type.constructor"><span>[type<wbr>.constructor]</span></a>
</div>

<h2 id="constructor"><a class="header" href="#constructor">Constructor</a></h2>
<p><strong>Subtype of:</strong> Callable</p>
<p>A constructor is a special kind of function responsible for object creation.</p>
<div class="rule" id="r-type.constructor.call"><a class="rule-link" href="#r-type.constructor.call" title="type.constructor.call"><span>[type<wbr>.constructor<wbr>.call]</span></a>
</div>

<p>When called, it creates a new object and is able to initialize that object.</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-dec64">
<p>Douglas Crockford: <em>DEC64</em>. <a href="https://www.crockford.com/dec64.html">https://www.crockford.com/dec64.html</a> <a href="#fr-dec64-1">↩</a></p>
</li>
<li id="footnote-float">
<p>“IEEE Standard for Floating-Point Arithmetic,” in IEEE Std 754-2019 (Revision of IEEE 754-2008), vol., no., pp.1-84, 22 July 2019, doi: 10.1109/IEEESTD.2019.8766229. <a href="#fr-float-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-naming"><a class="rule-link" href="#r-naming" title="naming"><span>[naming]</span></a>
</div>

<h1 id="naming"><a class="header" href="#naming">Naming</a></h1>
<div class="rule" id="r-naming.function"><a class="rule-link" href="#r-naming.function" title="naming.function"><span>[naming<wbr>.function]</span></a>
</div>

<h2 id="function-scoping"><a class="header" href="#function-scoping">Function scoping</a></h2>
<p>For the purposes of function scoping, constructors are also considered functions.</p>
<div class="rule" id="r-naming.function.nametable"><a class="rule-link" href="#r-naming.function.nametable" title="naming.function.nametable"><span>[naming<wbr>.function<wbr>.nametable]</span></a>
</div>

<p>When a function is called, a nametable specific to this function invocation is placed just below the function arguments. This function nametable is initially empty. Once the function returns, this nametable is discarded.</p>
<div class="rule" id="r-naming.function.global-nametable"><a class="rule-link" href="#r-naming.function.global-nametable" title="naming.function.global-nametable"><span>[naming<wbr>.function<wbr>.global-nametable]</span></a>
</div>

<p>Each function has a reference to the global nametable that was in effect during its creation with the <a href="#r-pt.function"><code>function</code></a> PT. During function execution, the global nametable is the same as the global nametable when the function was created.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>This allows functions from any module to execute in any other module with the “obvious” behavior surrounding globals. The globals do not suddenly change just because the function is being executed elsewhere. Importantly, this means that functions have access to private (module-internal) functionality and data, supporting encapsulation.</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<h1 id="primitive-tokens"><a class="header" href="#primitive-tokens">Primitive Tokens</a></h1>
<p>Every primitive stack operation is called a primitive token. It is listed with its arguments, the stacklowest argument first, and its return value description. No return value section means that this operation places nothing on the stack. Get familiar with this argument and return type shorthand, it is used in all the documentation.</p>
<h3 id="operation-special-cases-for-identifiers"><a class="header" href="#operation-special-cases-for-identifiers">Operation special cases for identifiers</a></h3>
<p>In order to make in-place modification of defined values easier, it’s possible to combine any of the binary operations <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>=</code>, <code>/=</code>, <code>and</code>, <code>or</code>, <code>xor</code> with an identifier as the first (right, lower) argument. This will retrieve the value from the identifier through a <code>.</code>-like call, perform the operation on that value as the right argument instead, and then store the result back into the identifier like normal <code>def</code>. The result does not remain on the stack. This is equivalent to the +=, -= etc. operator found in many programming languages.</p>
<h2 id="miscellaneous-tokens"><a class="header" href="#miscellaneous-tokens">Miscellaneous tokens</a></h2>
<h3 id="input-string-input-function"><a class="header" href="#input-string-input-function"><code>input</code> (string input function)</a></h3>
<p><strong>Return value</strong> &lt; the token read from stdin: String</p>
<p>Reads one word, i.e. everything in the standard input up to the first (Unicode) whitespace character, without trailing or leading whitespace characters.</p>
<h3 id="inputln-line-string-input-function"><a class="header" href="#inputln-line-string-input-function"><code>inputln</code> (line string input function)</a></h3>
<p><strong>Return value</strong> &lt; the line read from stdin without line terminator(s): String</p>
<p>Reads one line (any combination of line separators end one line) from standard input.</p>
<h3 id="write-output-function"><a class="header" href="#write-output-function"><code>write</code> (output function)</a></h3>
<p><strong>Arguments</strong> &lt; output: String</p>
<p>Writes the argument to standard output.</p>
<h3 id="writeln-output-function-w-line-break"><a class="header" href="#writeln-output-function-w-line-break"><code>writeln</code> (output function w/ line break)</a></h3>
<p><strong>Arguments</strong> &lt; output: String</p>
<p>Writes the argument to standard output and terminates the line.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="arithmetic-and-logic-pts"><a class="header" href="#arithmetic-and-logic-pts">Arithmetic and Logic PTs</a></h1>
<h2 id="-add-operator"><a class="header" href="#-add-operator"><code>+</code> (add operator)</a></h2>
<p><strong>Arguments</strong> &lt; left: Number &lt; right: Number</p>
<p><strong>Return value</strong> &lt; Mathematically: <code>left + right</code>: Number</p>
<p>Computes the sum of the two arguments. The result is an Integer if both arguments are Integers and a Decimal if any argument is a Decimal. Throws <code>TypeError</code> if any of the arguments has a non-number type.</p>
<h2 id="--subtract-operator"><a class="header" href="#--subtract-operator"><code>-</code> (subtract operator)</a></h2>
<p><strong>Arguments</strong> &lt; left: Number &lt; right: Number</p>
<p><strong>Return value</strong> &lt; Mathematically: <code>left - right</code>: Number</p>
<p>Computes the difference between the two arguments. The result is an Integer if both arguments are Integers and a Decimal if any argument is a Decimal. Throws <code>TypeError</code> if any of the arguments has a non-number type.</p>
<h2 id="-multiply-operator"><a class="header" href="#-multiply-operator"><code>*</code> (multiply operator)</a></h2>
<p><strong>Arguments</strong> &lt; left: Number &lt; right: Number</p>
<p><strong>Return value</strong> &lt; Mathematically: <code>left · right</code>: Number</p>
<p>Computes the product of the two arguments. The result is an Integer if both arguments are Integers and a Decimal if any argument is a Decimal. Throws <code>TypeError</code> if any of the arguments has a non-number type.</p>
<h2 id="-divide-operator"><a class="header" href="#-divide-operator"><code>/</code> (divide operator)</a></h2>
<p><strong>Arguments</strong> &lt; left: Number &lt; right: Number</p>
<p><strong>Return value</strong> &lt; Mathematically: <code>left ÷ right</code>: Number</p>
<p>Computes the result of the first argument divided by the second argument. The result is an Integer (division with remainder) if both arguments are Integers and a Decimal (division) if any argument is a Decimal. Throws <code>TypeError</code> if any of the arguments has a non-number type. Throws <code>ArithmeticError</code> if the right argument is zero.</p>
<h2 id="-modulus-operator"><a class="header" href="#-modulus-operator"><code>%</code> (modulus operator)</a></h2>
<p><strong>Arguments</strong> &lt; left: Number &lt; right: Number</p>
<p><strong>Return value</strong> &lt; Mathematically: <code>left mod right</code>: Number</p>
<p>Computes the result of the first argument modulus by the second argument. First, any Decimals are converted to Integers. Then, the remainder of the integer division of the two arguments is computed and returned. Throws <code>TypeError</code> if any of the arguments has a non-number type. Throws <code>ArithmeticError</code> if the right argument is zero.</p>
<h2 id="--logical-bit-shift-operators"><a class="header" href="#--logical-bit-shift-operators"><code>&lt;&lt;</code>, <code>&gt;&gt;</code> (logical bit shift operators)</a></h2>
<p><strong>Arguments</strong> &lt; base: Number &lt; amount: Number</p>
<p><strong>Return value</strong> &lt; base (<code>&lt;&lt;</code> or <code>&gt;&gt;</code>) amount: Integer</p>
<p>Computes the logical bit shift, that is the base (first argument) shifted left (&lt;&lt;) or right (&gt;&gt;) amount number of bits. Because this is a logical shift, it does not sign-extend the base. If this operation receives Floats as arguments, it truncates them to Integers.</p>
<h2 id="----comparison-operators"><a class="header" href="#----comparison-operators"><code>&lt;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;=</code> (comparison operators)</a></h2>
<p><strong>Arguments</strong> &lt; left: Number &lt; right: Number</p>
<p><strong>Return value</strong> &lt; Result of the comparison: Boolean</p>
<p>Compares the two arguments, always in the form <code>left &lt;comp&gt; right</code>. The operators are less than, greater than, less than or equal, greater than or equal, respectively. This operation throws a <code>TypeError</code> if any of the arguments is not a Number.</p>
<h2 id="--equality-operators"><a class="header" href="#--equality-operators"><code>=</code>, <code>/=</code> (equality operators)</a></h2>
<p><strong>Arguments</strong> &lt; left &lt; right</p>
<p><strong>Return value</strong> &lt; Whether the values are equal/unequal: Boolean</p>
<p>Checks whether the two arguments are equal or not equal, respectively. Two arguments are compared using the following algorithm:</p>
<ul>
<li>If both arguments are Numbers: Check whether their numeric value is equal. Integers are converted to Floats if at least one of the arguments is a Float.</li>
<li>If both arguments are Booleans: Check whether they represent the same truth value.</li>
<li>If both arguments are Strings: Check if every single one of their characters matches in order.</li>
<li>If both arguments are Objects: Check if their nametables contain the same value for each key and whether they contain the same list of keys. The values are checked with this same algorithm.</li>
<li>If both arguments are any other builtin value: Return false. This applies most importantly to CodeBlocks and Functions, as there is no simple way of determining their equality.</li>
</ul>
<p>If the arguments aren’t of the same type, upcasting is done, where Booleans upcast to Numbers and all other types upcast to Strings. This means that, for example, <code>"2" 2 =</code> holds true. For stricter equality, check the types first.</p>
<h2 id="and-or-xor-binary-logic-operators"><a class="header" href="#and-or-xor-binary-logic-operators"><code>and</code>, <code>or</code>, <code>xor</code> (binary logic operators)</a></h2>
<p><strong>Arguments</strong> &lt; left &lt; right</p>
<p><strong>Return value</strong> &lt; result of the operation: Boolean</p>
<p>Compares the two operators according to their Boolean value. The algorithm of finding the boolean value is the exact same as <a href="#builtin-functions"><code>convert:bool</code></a> uses.</p>
<h2 id="not-negation-operator"><a class="header" href="#not-negation-operator"><code>not</code> (negation operator)</a></h2>
<p><strong>Arguments</strong> &lt; arg</p>
<p><strong>Return value</strong> &lt; result of the negation: Boolean</p>
<p>Negates <code>arg</code>’s value; if it was true, it is now false, if it was false, it is now true. If the argument is not a Boolean, its truthiness value is determined according to <code>convert:bool</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="control-flow"><a class="header" href="#control-flow">Control flow</a></h1>
<h2 id="dowhile-loop-with-at-least-one-iteration"><a class="header" href="#dowhile-loop-with-at-least-one-iteration"><code>dowhile</code> (loop with at least one iteration)</a></h2>
<p>Identical to <code>while</code>, but will execute the body callable before checking the condition, which results in at least one call to the body.</p>
<h2 id="if-conditional-execution-operator"><a class="header" href="#if-conditional-execution-operator"><code>if</code> (conditional execution operator)</a></h2>
<p><strong>Arguments</strong> &lt; to execute: Callable &lt; condition: Boolean</p>
<p>Executes the callable if <code>condition</code> is true.</p>
<h2 id="ifelse-conditional-execution-operator-with-alternative"><a class="header" href="#ifelse-conditional-execution-operator-with-alternative"><code>ifelse</code> (conditional execution operator with alternative)</a></h2>
<p><strong>Arguments</strong> &lt; to execute: Callable &lt; condition: Boolean &lt; to execute otherwise: Callable</p>
<p>Executes the first callable if <code>condition</code> is true. Otherwise, executes the second callable.</p>
<h2 id="switch-multi-ifelse-conditional-execution-operator"><a class="header" href="#switch-multi-ifelse-conditional-execution-operator"><code>switch</code> (multi-ifelse conditional execution operator)</a></h2>
<p><strong>Arguments</strong> &lt; “<code>switch::</code>” (Identifier) &lt; ( case body: Callable &lt; case condition: Callable ) * any number of times &lt; default body: Callable</p>
<p>Compact alternative to nested <code>ifelse</code>’s. The behavior of this is as follows:</p>
<p>The default body, the element last on the stack, is stored for later use. Then, the entire stack is traversed two elements at a time. If the first element is the identifier “<code>switch::</code>”, the beginning/end of the switch has been reached; this special identifier serves as a sort of label to delineate the statement from the other, likely important stuff on the stack. As no case has been executed yet, the default body is executed.</p>
<p>If, however, the first element is a Callable, it is executed and the algorithm expects a Boolean value to be situated on top of the stack afterward. If this Boolean is true, the second element, the corresponding case body, is executed. Otherwise, the search continues.</p>
<h2 id="while-loop-function"><a class="header" href="#while-loop-function"><code>while</code> (loop function)</a></h2>
<p><strong>Arguments</strong> &lt; body: Callable &lt; condition: Callable</p>
<p>For every iteration of executing the body, executes the condition callable, which should place a Boolean value onto the stack. If the boolean value is true, the body will be executed once and the cycle repeats, if it is false, the loop will end.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="stack--naming"><a class="header" href="#stack--naming">Stack &amp; Naming</a></h1>
<h2 id="def-definition-operator"><a class="header" href="#def-definition-operator"><code>def</code> (definition operator)</a></h2>
<p><strong>Arguments</strong> &lt; value: Value &lt; name: Identifier</p>
<p>Modifies the LNT by setting the key-value pair <code>name: value</code>. This means that now the value of the identifier <code>name</code> is “defined” to be the value <code>value</code>, hence the name. Will overwrite any existing binding to <code>name</code>.</p>
<h2 id="dup"><a class="header" href="#dup"><code>dup</code></a></h2>
<p><strong>Arguments</strong> &lt; elmt: Value</p>
<p><strong>Return value</strong> &lt; elmt &lt; elmt</p>
<p>Duplicates the topmost element on the stack.</p>
<h2 id="globaldef-global-definition-operator"><a class="header" href="#globaldef-global-definition-operator"><code>globaldef</code> (global definition operator)</a></h2>
<p>The same as <code>def</code>, but always defines into the GNT.</p>
<h2 id="pop-stack-remove-operator"><a class="header" href="#pop-stack-remove-operator"><code>pop</code> (stack remove operator)</a></h2>
<p><strong>Arguments</strong> &lt; any</p>
<p>Removes the topmost element from the stack and discards it.</p>
<h2 id="swap-stack-exchange-operator"><a class="header" href="#swap-stack-exchange-operator"><code>swap</code> (stack exchange operator)</a></h2>
<p><strong>Arguments</strong> &lt; x &lt; y</p>
<p><strong>Return value</strong> &lt; y &lt; x</p>
<p>Exchanges the position of the two top-most elements on the stack.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="functional"><a class="header" href="#functional">Functional</a></h1>
<h2 id="-call-operator"><a class="header" href="#-call-operator"><code>.</code> (call operator)</a></h2>
<p><strong>Arguments</strong> &lt; 0 or more &lt; tocall: Callable</p>
<p><strong>Return value</strong> &lt; any value or none</p>
<p>Calls the topmost element of the stack. Each type exhibits its own behavior when called, but the most basic are:</p>
<ul>
<li>Most primitives return themselves.</li>
<li>Calling an identifier looks up that identifier’s value in the innermost scope that has the identifier defined or throws a <code>NameError</code> if that fails.</li>
<li>Calling a namespace looks up the next stack element, an identifier, in that namespace. This process is recursive, although currently namespaces cannot be nested.</li>
<li>Calling a function executes it and consumes the specified number of arguments from the stack. The return value of the function is placed on the stack. An exception to this is when the function arguments are “blocked off” with a currying operator (see below). In that case, the function is not called but it and the curried arguments replaced by the curried function.</li>
<li>Calling a code block executes it. There are neither arguments nor a return value.</li>
</ul>
<h2 id="-doublecallfunction-invoke-operator"><a class="header" href="#-doublecallfunction-invoke-operator"><code>:</code> (doublecall/function invoke operator)</a></h2>
<p><strong>Arguments</strong> &lt; 0 or more &lt; tocall: Callable</p>
<p><strong>Return value</strong> &lt; any value or none</p>
<p>Calls the topmost element of the stack twice. I.e., after the first call, the now topmost element is immediately called again. Therefore, this PT is a shortcut that is exactly equivalent to (and faster than) <code>. .</code>. This is intended for convenient use of named functions, i.e. functions defined into a namespace. The first call will retrieve the function itself onto the stack, and the second call will execute it. Therefore, the normal way you will see functions be used is with <code>:</code>, and it’s an easy indicator of distinguishing a variable lookup from a function call.</p>
<h2 id="-currying-marker"><a class="header" href="#-currying-marker"><code>|</code> (currying marker)</a></h2>
<p>This is a pseudo-value on the stack that does nothing and is invisible to almost all operations. It is used to limit the number of arguments a function receives. If a function, while retrieving arguments from the stack for calling, encounters a currying marker before all necessary arguments are found, the function is not called but a curried function is created instead that has the specified number of arguments “pre-stored”. The curried function can be called later, it takes the number of remaining arguments. These appear on the stack below the curried arguments, so that the actual argument order inside the function doesn’t change.</p>
<h2 id="function-function-definition-operator"><a class="header" href="#function-function-definition-operator"><code>function</code> (function definition operator)</a></h2>
<p><strong>Arguments</strong> &lt; code: CodeBlock &lt; argcount: Integer</p>
<p>Creates a function with <code>argcount</code> arguments. Usually, it is then <code>def</code>’d or <code>globaldef</code>’d with a name.</p>
<h2 id="nativecall-native-function-invocation-operator"><a class="header" href="#nativecall-native-function-invocation-operator"><code>nativecall</code> (native function invocation operator)</a></h2>
<p><strong>Arguments</strong> &lt; any number of arguments &lt; native function identifier: String</p>
<p><strong>Return value</strong> &lt; any</p>
<p>Calls a function defined natively in the interpreter. <a href="Reference/Language-internals.html#native-calls">Learn more</a>.</p>
<h2 id="return-function-return-operator"><a class="header" href="#return-function-return-operator"><code>return</code> (function return operator)</a></h2>
<p><strong>Arguments</strong> &lt; any</p>
<p>Saves the topmost value on the stack as the current function’s return value, then returns from the function immediately, exiting all non-function scopes (like code blocks) and clearing the stack down the function’s scope.</p>
<h2 id="return0-value-less-function-return-operator"><a class="header" href="#return0-value-less-function-return-operator"><code>return:0</code> (value-less function return operator)</a></h2>
<p>Returns from the current function just like <code>return</code>, but does not return any value (and does not consume anything from the stack).</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="typing-related-pts"><a class="header" href="#typing-related-pts">Typing-related PTs</a></h1>
<p>This includes PTs that create or handle complex types.</p>
<h2 id="-list-marker"><a class="header" href="#-list-marker"><code>[</code> (list marker)</a></h2>
<p>This is a pseudo-value on the stack that does nothing and is invisible to almost all operations. It is used as a delimiter for the start of a list when the list creator <code>]</code> is used.</p>
<h2 id="-list-creator"><a class="header" href="#-list-creator"><code>]</code> (list creator)</a></h2>
<p><strong>Arguments</strong> &lt; <code>[</code> &lt; any number of elements (&lt; <code>]</code>)</p>
<p><strong>Return value</strong> &lt; literal: List</p>
<p>Creates a new list from a number of literal values. This operation traverses the stack downwards until it hits the list start marker <code>[</code>; this means that the list creator operation is the only one that actually handles the start marker and doesn’t just ignore it. All the elements in between are used as the initial values of the list, and they are ordered such that the lowest values are the first in the list. For example, the code <code>[ 1 2 3 ]</code> creates a list with the Integer elements 1, 2, and 3, in that exact order. This entire literal list creation system is therefore very intuitive while still respecting SOF’s orthagonality.</p>
<h2 id="-fieldcall-operator"><a class="header" href="#-fieldcall-operator"><code>,</code> (fieldcall operator)</a></h2>
<p><strong>Arguments</strong> &lt; object: Object &lt; field: Callable</p>
<p><strong>Return value</strong> &lt; object &lt; value</p>
<p>Executes a call on the object’s nametable with the given field as a Callable to execute. The field is usually an identifier identifying a field value on the object in question. It can however be any sort of callable data, including callables that do not interact with their nametable. The object is left on the stack below the return value, making it easily available for further processing.</p>
<h2 id="-methodcall-operator"><a class="header" href="#-methodcall-operator"><code>;</code> (methodcall operator)</a></h2>
<p><strong>Arguments</strong> &lt; object: Object &lt; 0 or more &lt; tocall: Callable</p>
<p><strong>Return value</strong> object &lt; any value or none</p>
<p>Calls the topmost element of the stack twice, like <code>:</code>. Additionally, remembers the object before the calls occur and places it back onto the stack below the return value of the second call. Furthermore, the function call actually happens with the object nametable as the function nametable, so the function can use object attributes as variables and modify the object with <code>def</code>’s. It is also possible to add new attributes to an object; for this reason, if you need named temporaries you should use an inner dummy function.</p>
<p>This operator is intended to be used with method-like named functions, functions that expect an object to operate on. SOF technically has no bound functions (you can emulate them by attaching function values to object attributes, but using those is a lot more cumbersome), so all functions that act like methods are free functions expecting some object to operate on. The big advantage is that as long as you pass an object that <em>behaves</em> like the one the function expects, the function will operate just fine. The method call operation will leave the program with the result of the operation (possibly none), and the original object below it, which allows for it to be used further.</p>
<h2 id="constructor-constructor-creation-operator"><a class="header" href="#constructor-constructor-creation-operator"><code>constructor</code> (constructor creation operator)</a></h2>
<p><strong>Arguments</strong> &lt; code: CodeBlock &lt; args: Integer</p>
<p><strong>Return value</strong> &lt; constructor: Constructor</p>
<p>Creates a new object creation template by turning the code block into a constructor function. Inside the constructor’s code block, <code>def</code>s can be used to initialize fields on the object’s nametable. A new object can be created by executing the constructor; this is the earliest time that the code body is executed. Just like other functions, the constructor can obtain any number of arguments when called.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="modules"><a class="header" href="#modules">Modules</a></h1>
<div class="rule" id="r-pt.dexport"><a class="rule-link" href="#r-pt.dexport" title="pt.dexport"><span>[pt<wbr>.dexport]</span></a>
</div>

<h2 id="dexport-definitionexport-operator"><a class="header" href="#dexport-definitionexport-operator"><code>dexport</code> (definition+export operator)</a></h2>
<div class="rule" id="r-pt.dexport.arguments"><a class="rule-link" href="#r-pt.dexport.arguments" title="pt.dexport.arguments"><span>[pt<wbr>.dexport<wbr>.arguments]</span></a>
</div>

<p><strong>Arguments</strong> &lt; value: Value &lt; name: Identifier</p>
<p>The <code>dexport</code> primitive token binds and exports a name-value pair. It is a convenience feature that has identical behavior to <code>&lt;name&gt; globaldef &lt;name&gt; export</code>.</p>
<div class="rule" id="r-pt.dexport.opsem"><a class="rule-link" href="#r-pt.dexport.opsem" title="pt.dexport.opsem"><span>[pt<wbr>.dexport<wbr>.opsem]</span></a>
</div>

<p>The runtime behavior of <code>dexport</code> is as follows:</p>
<ol>
<li><a href="#r-naming.global-bind">Store the (name, value) binding in the global nametable</a>.</li>
<li><a href="#r-modules.export">Export</a> the (name, value) binding from the current module.</li>
</ol>
<div class="rule" id="r-pt.export"><a class="rule-link" href="#r-pt.export" title="pt.export"><span>[pt<wbr>.export]</span></a>
</div>

<h2 id="export"><a class="header" href="#export"><code>export</code></a></h2>
<div class="rule" id="r-pt.export.arguments"><a class="rule-link" href="#r-pt.export.arguments" title="pt.export.arguments"><span>[pt<wbr>.export<wbr>.arguments]</span></a>
</div>

<p><strong>Arguments</strong> &lt; name: Identifier</p>
<p>The <code>export</code> primitive token exports the value bound to the name in the module namespace.</p>
<div class="rule" id="r-pt.export.opsem"><a class="rule-link" href="#r-pt.export.opsem" title="pt.export.opsem"><span>[pt<wbr>.export<wbr>.opsem]</span></a>
</div>

<p>The runtime behavior of <code>export</code> is as follows:</p>
<ol>
<li><a href="#r-naming.lookup">Lookup</a> the value associated with the given name in the current scope.</li>
<li><a href="#r-modules.export">Export</a> the (name, value) binding obtained in the previous step from the current module.</li>
</ol>
<div class="rule" id="r-pt.use"><a class="rule-link" href="#r-pt.use" title="pt.use"><span>[pt<wbr>.use]</span></a>
</div>

<h2 id="use-import-module"><a class="header" href="#use-import-module"><code>use</code> (import module)</a></h2>
<div class="rule" id="r-pt.use.arguments"><a class="rule-link" href="#r-pt.use.arguments" title="pt.use.arguments"><span>[pt<wbr>.use<wbr>.arguments]</span></a>
</div>

<p><strong>Arguments</strong> &lt; module name: String</p>
<p>The <code>use</code> primitive token is used to import a module.</p>
<div class="rule" id="r-pt.use.opsem"><a class="rule-link" href="#r-pt.use.opsem" title="pt.use.opsem"><span>[pt<wbr>.use<wbr>.opsem]</span></a>
</div>

<p>The runtime behavior of <code>use</code> is as follows. For the purposes of this description, “source module” refers to the module that contains the <code>use</code> PT in question, and “target module” refers to the module being imported.</p>
<ol>
<li>Resolve the target module named by the given module name, using the <a href="#r-modules.resolution">module resolution algorithm</a>. The result of module name resolution is an unambiguous file system path.</li>
<li>Load the SOF <a href="#r-source-file">source file</a> from the file system path determined in the previous step, and propagate any errors. This step MAY be cached.</li>
<li>Place a <a href="#r-naming.nametable">nametable</a> on top of the stack.
<ul>
<li>This nametable will be referred to as the “module” nametable.</li>
<li>For the remainder of the execution of the target module, the module nametable functions as the global nametable. Any specification referencing the global nametable therefore references the module nametable while the module is being executed.</li>
</ul>
</li>
<li><a href="#r-execution">Execute</a> the token list of the target module’s source file.</li>
<li>Remove the module nametable from the stack, as well as all tokens above it.</li>
<li><a href="#r-modules.import">Import</a> all names into the source module which were <a href="#r-modules.export">exported</a> from the target module.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="builtin-functions"><a class="header" href="#builtin-functions">Builtin functions</a></h1>
<p>These functions are always available to the user, and part of the <code>prelude</code> file in the standard library. The difference to other modules is that the prelude file is executed as if its text was in the file itself, so normal module mechanisms don’t apply unless you explicitly <code>"prelude" use</code>.</p>
<h2 id="convertbool-not-implemented"><a class="header" href="#convertbool-not-implemented"><code>convert:bool</code> (Not implemented)</a></h2>
<p><strong>Arguments</strong> &lt; toConvert</p>
<p><strong>Return value</strong>: converted: Boolean</p>
<p>Converts the argument to a Boolean. If the value is not already a Boolean, it uses the “truthyness” of the argument, which is almost always true. When the argument is 0 or 0.0, it is false.</p>
<h2 id="convertdecimal"><a class="header" href="#convertdecimal"><code>convert:decimal</code></a></h2>
<p><strong>Arguments</strong> &lt; toConvert</p>
<p><strong>Return value</strong>: converted: Decimal</p>
<p>Converts the argument to a float. The argument can either be a string containing a valid SOF float literal (plus any leading/trailing whitespace), an integer or a float already. The result is the corresponding float value; the function fails with a TypeError if conversion fails, e.g. wrong number format, unsupported origin type.</p>
<h2 id="convertint"><a class="header" href="#convertint"><code>convert:int</code></a></h2>
<p><strong>Arguments</strong> &lt; toConvert</p>
<p><strong>Return value</strong>: converted: Integer</p>
<p>Converts the argument to an integer. The argument can either be a string containing a valid SOF integer literal (plus any leading/trailing whitespace), an integer already or a float to be rounded. The result is the corresponding integer value; the function fails with a TypeError if conversion fails, e.g. wrong number format, unsupported origin type.</p>
<h2 id="convertstring"><a class="header" href="#convertstring"><code>convert:string</code></a></h2>
<p><strong>Arguments</strong> &lt; toConvert</p>
<p><strong>Return value</strong>: converted: String</p>
<p>Converts the argument to its string representation. This is the same process used by the output methods. The argument can be of any type, as any SOF type has a string representation, but the result might not be beautiful.</p>
<h2 id="convertcallable"><a class="header" href="#convertcallable"><code>convert:callable</code></a></h2>
<p><strong>Arguments</strong> &lt; toConvert</p>
<p><strong>Return value</strong>: converted: Callable</p>
<p>Converts the argument to its callable equivalent. This has the following result:</p>
<ul>
<li>“Real” callables are unchanged. This affects functions, code blocks and identifiers.</li>
<li>Primitives are converted to a <a href="https://en.wikipedia.org/wiki/Church_encoding">Church encoding</a> version of themselves. (Not implemented) This means:
<ul>
<li>Natural numbers <code>n &gt;= 0</code> are converted to a callable that when called with another callable <code>f</code>, will call <code>f</code> <code>n</code> times. If <code>f</code> returns a value and receives an argument, this is exactly equivalent to the notion of Church numerals.</li>
<li>Booleans are converted to a callable that when called with two arguments, will return the first (stack-lowest) argument if it is <code>true</code>, otherwise, it will return the second argument. This also means that <code>ca cb</code><strong><code>cond if</code></strong> (<code>ca</code>, <code>cb</code> Callables, <code>cond</code> Boolean) is equivalent to <code>ca cb cond</code><strong><code>convert:callable : .</code></strong></li>
<li>Other Integers <code>x</code> are converted to a two-element list <code>[a, b]</code> where <code>a, b ∈ ℕ</code> are Church numerals as described above and <code>x = a - b</code>.</li>
<li>Decimals <code>x</code> are first converted to the most accurate rational representation. Then, a two-element list <code>[k, a]</code> is created where <code>k</code> is a Church numeral (integer), <code>a</code> is a Church-encoded natural number and <code>x = k / ( 1 + a )</code>.</li>
</ul>
</li>
</ul>
<p>The conversion fails on Strings and other more complex types and throws a TypeError.</p>
<h2 id="random01"><a class="header" href="#random01"><code>random:01</code></a></h2>
<p><strong>Return value</strong>: random number: Decimal</p>
<p>Generates a pseudo-random number between 0 (inclusive) and 1 (exclusive), optimally using a system-provided RNG (such as <code>/dev/urandom</code> on Linux). <strong>THIS PSEUDO-RANDOM NUMBER GENERATOR IS NOT GUARANTEED TO BE CRYPTOGRAPHICALLY SAFE.</strong></p>
<h2 id="randomint"><a class="header" href="#randomint"><code>random:int</code></a></h2>
<p><strong>Arguments</strong> &lt; start: Integer &lt; end: Integer</p>
<p><strong>Return value</strong>: random number: Integer</p>
<p>Generates a pseudo-random number between start and end, inclusive. Uses <code>random01</code> as the initial source of randomness (and, therefore, is NOT CRYPTOGRAPHICALLY SAFE).</p>
<h2 id="randomdecimal"><a class="header" href="#randomdecimal"><code>random:decimal</code></a></h2>
<p><strong>Arguments</strong> &lt; start: Decimal &lt; end: Decimal</p>
<p><strong>Return value</strong>: random number: Decimal</p>
<p>Floating-point variant of <code>random:int</code> with equivalent behavior. Returns any floating point number between start and end, inclusive.</p>
<h2 id="fmtx"><a class="header" href="#fmtx"><code>fmt'x</code></a></h2>
<p><strong>Arguments</strong> &lt; format: String &lt; x format arguments</p>
<p><strong>Return value</strong>: formatted: String</p>
<p>Formats a string with a number of format arguments. <code>fmt'x</code> is just a placeholder name; the actual functions are called <code>fmt'0</code> through <code>fmt'9</code> with 0-9 arguments, respectively. The exact format specificer format is not well-documented and can be found with the relevant native implementations. It’s similar to Java’s format string syntax though, and some tests exist for it.</p>
<h2 id="pair-create-a-tuple"><a class="header" href="#pair-create-a-tuple"><code>pair</code>: Create a tuple</a></h2>
<p><strong>Arguments</strong> &lt; a: Any value &lt; b: Any value</p>
<p><strong>Return value</strong> &lt; [ a, b ] : List</p>
<p>Creates a two-element list from the two arguments. Main function for creating tuple-like lists (short lists of known length) and returning two values.</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-modules"><a class="rule-link" href="#r-modules" title="modules"><span>[modules]</span></a>
</div>

<h1 id="the-sof-module-system"><a class="header" href="#the-sof-module-system">The SOF Module System</a></h1>
<div class="rule" id="r-modules.files"><a class="rule-link" href="#r-modules.files" title="modules.files"><span>[modules<wbr>.files]</span></a>
</div>

<p>Each SOF source code file ending in <code>.sof</code> is a separate module.</p>
<div class="rule" id="r-modules.nesting"><a class="rule-link" href="#r-modules.nesting" title="modules.nesting"><span>[modules<wbr>.nesting]</span></a>
</div>

<p>Sub-folders can be used to define sub-modules, where all the modules in the folder are considered children of the module with the same name as the folder.</p>
<div class="rule" id="r-modules.errors"><a class="rule-link" href="#r-modules.errors" title="modules.errors"><span>[modules<wbr>.errors]</span></a>
</div>

<h2 id="errors-2"><a class="header" href="#errors-2">Errors</a></h2>
<div class="rule" id="r-modules.errors.circular-import"><a class="rule-link" href="#r-modules.errors.circular-import" title="modules.errors.circular-import"><span>[modules<wbr>.errors<wbr>.circular-import]</span></a>
</div>

<p>It is an error to import a module that is already currently executing. In other words, the module import graph must be acyclic.</p>
<div class="rule" id="r-modules.naming"><a class="rule-link" href="#r-modules.naming" title="modules.naming"><span>[modules<wbr>.naming]</span></a>
</div>

<h2 id="module-names"><a class="header" href="#module-names">Module names</a></h2>
<p>The name of a module can consist of any Unicode code points from the following set:</p>
<ul>
<li>ASCII Alphabetic (code points <code>U+0041</code>-<code>U+005A</code> and <code>U+0061</code>-<code>U+007A</code>)</li>
<li>ASCII Numeric (code points <code>U+0030</code>-<code>U+0039</code>)</li>
<li>The characters <code>_</code> and <code>.</code>.</li>
</ul>
<div class="rule" id="r-modules.naming.absolute"><a class="rule-link" href="#r-modules.naming.absolute" title="modules.naming.absolute"><span>[modules<wbr>.naming<wbr>.absolute]</span></a>
</div>

<p>Absolute modules do not start with a dot <code>.</code>. They are resolved using <a href="#r-modules.resolution.absolute">library module resolution</a>.</p>
<div class="rule" id="r-modules.naming.relative"><a class="rule-link" href="#r-modules.naming.relative" title="modules.naming.relative"><span>[modules<wbr>.naming<wbr>.relative]</span></a>
</div>

<p>Relative modules start with a <code>.</code>. They are resolved using relative resolution.</p>
<div class="rule" id="r-modules.resolution"><a class="rule-link" href="#r-modules.resolution" title="modules.resolution"><span>[modules<wbr>.resolution]</span></a>
</div>

<h2 id="module-resolution"><a class="header" href="#module-resolution">Module resolution</a></h2>
<p>The purpose of module resolution is to resolve a module name that has been specified in a source module to a path which should be loaded as the corresponding target module. The result of module resolution depends only on the interpreter’s library configuration, the current module, and the target module name. Interpreters MAY cache previously-loaded modules by path.</p>
<div class="rule" id="r-modules.resolution.common"><a class="rule-link" href="#r-modules.resolution.common" title="modules.resolution.common"><span>[modules<wbr>.resolution<wbr>.common]</span></a>
</div>

<p>A module name can be resolved to a path by replacing all single dots except leading dots with the system path separator, and appending the <code>.sof</code> extension. Double dots are not replaced.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>The system path separator is <code>/</code> on Unix-like systems, and <code>\</code> on Microsoft Windows. Other systems may have other separators, and <code>/</code> is used as a fallback if there is no concept of files, such as in WebAssembly.</p>
</blockquote>
</div>

<p>Interpreters MAY allow alternative extensions for modules, but files with the <code>.sof</code> extension MUST take priority over any other files with the same base name during module resolution.</p>
<p>The resulting path is a relative path. Further resolution to a canonical absolute path depends on whether the module is relative or absolute.</p>
<div class="rule" id="r-modules.resolution.relative"><a class="rule-link" href="#r-modules.resolution.relative" title="modules.resolution.relative"><span>[modules<wbr>.resolution<wbr>.relative]</span></a>
</div>

<h3 id="relative-modules"><a class="header" href="#relative-modules">Relative modules</a></h3>
<p>Relative module names are resolved relative to the current module’s location. For this purpose, the relative path formed by the common module resolution procedure is appended to the directory of the current module.</p>
<div class="rule" id="r-modules.resolution.relative.up"><a class="rule-link" href="#r-modules.resolution.relative.up" title="modules.resolution.relative.up"><span>[modules<wbr>.resolution<wbr>.relative<wbr>.up]</span></a>
</div>

<p>In relative module imports only, double dots <code>..</code> are used to import a directory higher. Each <code>..</code> causes the remaining module path to be interpreted at the next-higher directory instead.</p>
<div class="rule" id="r-modules.resolution.relative.up.limits"><a class="rule-link" href="#r-modules.resolution.relative.up.limits" title="modules.resolution.relative.up.limits"><span>[modules<wbr>.resolution<wbr>.relative<wbr>.up<wbr>.limits]</span></a>
</div>

<p>The highest directory possible is the directory of the root module of the program if the relative import chain originates from the root module, or the directory of the libraries if the relative import chain originates from a library module that was imported absolutely.</p>
<div class="rule" id="r-modules.resolution.absolute"><a class="rule-link" href="#r-modules.resolution.absolute" title="modules.resolution.absolute"><span>[modules<wbr>.resolution<wbr>.absolute]</span></a>
</div>

<h3 id="absolute-modules"><a class="header" href="#absolute-modules">Absolute modules</a></h3>
<p>Absolute modules import modules in the library directory. This is a runtime-constant directory. Interpreters SHOULD allow the user to change this directory at startup, but MUST NOT allow it to be changed during runtime.</p>
<div class="rule" id="r-modules.resolution.absolute.contents"><a class="rule-link" href="#r-modules.resolution.absolute.contents" title="modules.resolution.absolute.contents"><span>[modules<wbr>.resolution<wbr>.absolute<wbr>.contents]</span></a>
</div>

<p>The library directory contains the SOF standard library. It MAY also contain modules added manually by the user or by package managers.</p>
<div class="rule" id="r-modules.resolution.absolute.use-relative"><a class="rule-link" href="#r-modules.resolution.absolute.use-relative" title="modules.resolution.absolute.use-relative"><span>[modules<wbr>.resolution<wbr>.absolute<wbr>.use-relative]</span></a>
</div>

<p>Modules imported absolutely are allowed to perform relative imports.</p>
<div class="rule" id="r-modules.pts"><a class="rule-link" href="#r-modules.pts" title="modules.pts"><span>[modules<wbr>.pts]</span></a>
</div>

<h2 id="module-primitive-tokens"><a class="header" href="#module-primitive-tokens">Module primitive tokens</a></h2>
<p><a href="#r-pt.use"><code>use</code></a>, <a href="#r-pt.export"><code>export</code></a>, and <a href="#r-pt.dexport"><code>dexport</code></a> are the only primitive tokens that directly interact with the module system.</p>
<div class="rule" id="r-modules.export"><a class="rule-link" href="#r-modules.export" title="modules.export"><span>[modules<wbr>.export]</span></a>
</div>

<h2 id="exporting-bindings-from-modules"><a class="header" href="#exporting-bindings-from-modules">Exporting bindings from modules</a></h2>
<p>Each module maintains an associated list, similar to a <a href="Naming.html#r-naming.nametable">nametable</a>, of <strong>exports</strong>.</p>
<p>When exporting a (name, value) binding from a module, this binding is stored in that list.</p>
<p>If a binding for the same name already exists, that binding is overwritten.</p>
<div class="rule" id="r-modules.import"><a class="rule-link" href="#r-modules.import" title="modules.import"><span>[modules<wbr>.import]</span></a>
</div>

<h2 id="importing-module-bindings"><a class="header" href="#importing-module-bindings">Importing module bindings</a></h2>
<p>After a target module finishes executing, its exported bindings are <strong>imported</strong> into the source module that loaded it.</p>
<div class="rule" id="r-modules.import.opsem"><a class="rule-link" href="#r-modules.import.opsem" title="modules.import.opsem"><span>[modules<wbr>.import<wbr>.opsem]</span></a>
</div>

<p>To import module bindings, all exported bindings are individually stored the source module’s global nametable. Existing bindings in the global nametable are overwritten with new bindings from the target module’s exports.</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>

<p>This behavior is exactly the same as if every exported item was <code>globaldef</code>’d in the source module.</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-does-sof-actually-work"><a class="header" href="#how-does-sof-actually-work">How does SOF actually work?</a></h1>
<p>This page shall describe the way that SOF works internally, while staying language-independent, as to accomodate other implementations of SOF compilers and interpreters. Nevertheless, Examples of the reference Java implementation shall be given, as it currently is the only existing implementation of SOF.</p>
<h2 id="data-structures"><a class="header" href="#data-structures">Data Structures</a></h2>
<p>SOF is a pure stack-based language. That means: All data always resides on the Stack, a linear unit of memory cells that contain data. Although we know a stack as being only LIFO and having one single visible element (the top, head or first element of the stack), in practice the SOF stack should be a <strong>Deque</strong>. If it wasn’t, one would need two independent stacks for many operations (but both of them could be real, pure stacks).</p>
<p>But what is a Deque? This term, pronounced “deck”, is short for “double ended queue” and describes a data structure with arbitrary access on both ends. The top of the deque is accessed with peek, pop and push, while the bottom of the deque is accessed with peekLast, popLast, pushLast. Java provides not only a Deque in its Collection framework, but also many specialized implementations, such as the currently used <code>ConcurrentLinkedDeque</code>, which is a double-linked-list implementation with threadsafety.</p>
<p>All data lives on the stack, this was already stated. But how does this allow for named variables, namespaces and function calling? The answer is the second most important data structure of SOF, the <strong>Nametable</strong>.</p>
<p>A Nametable is simply a list of key-value mappings (<code>Map</code> in Java and JavaScript, <code>dict</code> in python) that maps identifiers to any SOF data. Pretty simple, but this powers all of SOF. All defintions made by <code>def</code> are simply entries into nametables, the Call operator <code>.</code> simply accesses entries in nametables.</p>
<h3 id="the-global-nametable"><a class="header" href="#the-global-nametable">The Global Nametable</a></h3>
<p>The global nametable (GNT) is always the lowest element on the stack; when it is missing, something serious has gone wrong. The SOF programmer can never inspect, modify or remove the GNT, but it is being used all the time:</p>
<ul>
<li>All defintions made on a global level enter the GNT</li>
<li>All imported NNTs (see below) are placed in the GNT</li>
</ul>
<p>The GNT will be discussed in further detail with its use cases.</p>
<h2 id="scoping-the-call-and-def-operators"><a class="header" href="#scoping-the-call-and-def-operators">Scoping, the Call and Def operators</a></h2>
<p>A Scope is created whenever a function starts. The scope is signaled by a special NT on the stack, called a function delimiter (FD). FDs hold special information on where to return execution when the function ends and what the return value is. Also, the FD cannot be taken off the stack by the program in any other way than returning from executing the current code block or function.</p>
<p>As FDs are NTs, this means that at any point in the program there could be many NTs on the stack at once. To figure out which NT is to be used for the call operator <code>.</code> with an Identifier, the following simple rule is applied: <strong>Walk down the stack from top (last) to bottom (first). Whenever a Nametable is encountered, determine whether it contains the identifier that <code>.</code> wants to call. If so, retrieve this identifier’s value from this Nametable, if not, continue the search all the way to the NNT/GNT. If nothing is found, throw a NameError</strong>. This ensures that definitions made in a “more local” NT are more important and hide those in a “more global” NT.</p>
<p>Normally, <code>def</code> operates on the <strong>Local Nametable</strong> (LNT), which is simply the highest NT on the stack. This may be an FD, or the GNT if there is no FD. This importantly means that <strong>code inside a function cannot modify nametables outside unless using the <code>globaldef</code> operator</strong>:</p>
<p>Sometimes, the user wants to define into the GNT. For this, the operator <code>globaldef</code> is provided, which exhibits the same behavior as <code>def</code> except for always defining into the GNT. This is useful for defining functions in an enclosed scope, modifying global variables and so on. It is also convention to always <code>globaldef</code> global functions, constructors, etc.</p>
<h2 id="native-calls"><a class="header" href="#native-calls">Native calls</a></h2>
<p>The PT <code>nativecall</code> executes a call to a natively implemented function. The only explicit argument of the native call is a string identifying the native function to call. Because the reference implementation is Java-based, the way in which native functions are identified is very similar to Java method signatures. The general form is <code>NativeFunction = Package { "." Package } "." Class "#" Method "(" [ ArgumentType ] { "," ArgumentType } ")"</code>, where Package represents a legal Java package name, Class represents a legal Java class name and Method represents a legal Java method name. The argument types must be the internal SOF type names that the reference implementation uses, like StringPrimitive, FloatPrimitive etc. There may be any number of arguments separated by a comma (but no spaces!), and possibly none. The arguments are taken from the stack when <code>nativecall</code> runs, where the last argument taken from the stack is the first argument passed to the native function. The native function may return an SOF typed result, in which case it is placed on the stack, or it may return nothing (void), in which case the stack is not modified. Native functions may throw (incomplete) compiler exceptions, in which case they propagate from the <code>nativecall</code> as normal SOF errors of type <code>Native</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<ul>
<li><strong>PT</strong>: Primitive token. A special token that has the syntax of an identifier (i.e. if it wasn’t special, it would be treated as an identifier) but executes a special operation that (for the most part) cannot be accomplished by other means.</li>
<li><strong>Nametable</strong>: A key-value mapping structure (compare to Java’s &amp; JavaScript’s <code>Map</code>, python’s <code>dict</code>) that is the second most important data structure of SOF internally after the Stack. All Nametables live on the Stack.</li>
<li><strong>GNT</strong>: Global nametable. Lowest element on the stack, used for top-level lookups and <code>globaldef</code>. Exported functions keep the GNT at export time.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
